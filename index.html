<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>Vibe OS 25.0 - Integrity</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        :root { --primary:#00e676; --danger:#ff3d00; --gold:#ffd600; --bg:#000000; --surface:#111111; --text:#ffffff; --radius:22px; }
        * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; outline:none; }
        body { background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,sans-serif; margin:0; padding-bottom:160px; user-select:none; }
        
        /* UI COMPONENTS */
        .header { padding:15px 20px; display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.9); position:sticky; top:0; z-index:100; border-bottom:1px solid #222; backdrop-filter:blur(10px); }
        .brand { font-size:20px; font-weight:800; letter-spacing:-0.5px; }
        .icon-btn { width:40px; height:40px; border-radius:50%; background:#1c1c1e; display:flex; align-items:center; justify-content:center; border:1px solid #333; cursor:pointer; }
        
        .bento-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; padding:20px; }
        .bento-card { background:var(--surface); padding:20px; border-radius:var(--radius); border:1px solid #222; position:relative; overflow:hidden; }
        .bento-card.wide { grid-column:span 2; background:linear-gradient(135deg,#1a1a1a,#0a0a0a); }
        .bento-val { font-size:32px; font-weight:800; margin-top:5px; }
        .bento-lbl { font-size:11px; color:#888; text-transform:uppercase; font-weight:700; }

        /* FILTERS */
        .filter-sec { padding:0 20px; }
        .acc { margin-bottom:10px; background:var(--surface); border-radius:16px; border:1px solid #222; overflow:hidden; }
        .acc-head { padding:15px; font-size:14px; font-weight:700; display:flex; justify-content:space-between; border-right:3px solid transparent; }
        .acc-body { display:none; padding:15px; background:#080808; flex-wrap:wrap; gap:8px; border-top:1px solid #222; }
        .acc-body.open { display:flex; }
        
        .c-red .acc-head { border-color:var(--danger); }
        .c-blue .acc-head { border-color:var(--primary); }
        .c-gold .acc-head { border-color:var(--gold); }
        .c-purple .acc-head { border-color:#d500f9; }

        .chip { display:none; }
        .lbl { padding:8px 14px; background:#1a1a1a; border:1px solid #333; border-radius:50px; font-size:12px; color:#888; transition:0.2s; }
        .chip:checked + .lbl { background:#eee; color:#000; font-weight:bold; }
        .danger .chip:checked + .lbl { background:var(--danger); color:white; border-color:var(--danger); }
        .safe .chip:checked + .lbl { background:var(--primary); color:black; border-color:var(--primary); }

        /* SCANNER */
        #scanner-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:500; display:none; }
        #reader { width:100%; height:100%; object-fit:cover; }
        .scan-ui { position:absolute; top:0; left:0; width:100%; height:100%; padding:40px 20px; display:flex; flex-direction:column; justify-content:space-between; pointer-events:none; }
        .scan-frame { width:250px; height:250px; border:2px solid rgba(255,255,255,0.3); border-radius:20px; margin:auto; position:relative; box-shadow:0 0 0 1000px rgba(0,0,0,0.8); }
        .scan-frame::after { content:''; position:absolute; top:0; left:0; width:100%; height:2px; background:var(--primary); animation:scan 2s infinite ease-in-out; box-shadow:0 0 15px var(--primary); }
        @keyframes scan { 0%{top:0;opacity:0} 50%{opacity:1} 100%{top:100%;opacity:0} }
        .close-cam { pointer-events:auto; background:rgba(50,50,50,0.8); color:white; padding:10px 25px; border-radius:50px; border:none; font-weight:bold; margin:0 auto; backdrop-filter:blur(10px); }

        /* ACTION BAR */
        .action-bar { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); width:90%; max-width:400px; background:rgba(20,20,20,0.9); backdrop-filter:blur(15px); padding:8px; border-radius:100px; display:flex; justify-content:space-between; border:1px solid #333; z-index:300; }
        .bar-btn { width:50px; height:50px; border-radius:50%; border:none; background:transparent; color:#888; font-size:20px; display:flex; align-items:center; justify-content:center; }
        .scan-trigger { width:65px; height:65px; background:white; color:black; border-radius:24px; display:flex; align-items:center; justify-content:center; margin-top:-15px; box-shadow:0 5px 20px rgba(255,255,255,0.2); border:none; }
        .svg-icon { width:24px; height:24px; fill:currentColor; }

        /* SHEET & RESULTS */
        #sheet-wrapper { position:fixed; top:0; left:0; width:100%; height:100%; z-index:200; pointer-events:none; opacity:0; transition:0.3s; }
        .active-sheet { opacity:1 !important; pointer-events:auto !important; }
        #sheet-overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(5px); }
        #bottom-sheet { position:absolute; bottom:0; left:0; width:100%; background:#161616; border-radius:30px 30px 0 0; padding:30px 25px 80px 25px; transform:translateY(100%); transition:transform 0.4s cubic-bezier(0.2,0.8,0.2,1); border-top:1px solid #333; max-height:85vh; overflow-y:auto; }
        .active-sheet #bottom-sheet { transform:translateY(0); }

        .prod-header { display:flex; gap:15px; margin-bottom:20px; }
        .prod-thumb { width:80px; height:80px; background:white; border-radius:18px; object-fit:contain; padding:5px; }
        .editable-name { background:transparent; border:none; border-bottom:1px dashed #666; color:white; font-size:18px; font-weight:800; width:100%; padding:5px 0; font-family:inherit; }
        .editable-name:focus { border-color:var(--primary); }
        
        .score-circle { width:60px; height:60px; border-radius:50%; border:4px solid #333; display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:800; }
        .analysis-box { background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; font-size:13px; line-height:1.5; }
        
        /* SETTINGS */
        #settings-layer { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:400; transform:translateY(100%); transition:0.4s; padding:20px; overflow-y:auto; }
        .settings-active #settings-layer { transform:translateY(0); }
        .clean-inp { width:100%; background:#1c1c1e; border:1px solid #333; color:white; padding:15px; border-radius:12px; font-size:16px; margin-bottom:10px; text-align:center; }
    </style>
</head>
<body id="app-body">

    <div class="header">
        <div class="brand">Vibe OS <span style="font-size:12px; color:#666;">25.0</span></div>
        <div class="icon-btn" onclick="toggleSettings()"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg></div>
    </div>

    <div class="bento-grid">
        <div class="bento-card wide"><div class="bento-lbl">×ª×§×¦×™×‘ ×§×œ×•×¨×™</div><div class="bento-val" id="d-cals">...</div></div>
        <div class="bento-card"><div class="bento-lbl">××˜×¨×”</div><div class="bento-val" id="d-goal">...</div></div>
        <div class="bento-card"><div class="bento-lbl">×‘×¡×œ</div><div class="bento-val" id="d-cart">0</div></div>
    </div>

    <div class="filter-sec">
        <div style="font-size:11px; color:#555; margin:10px 0; font-weight:800; text-transform:uppercase;">×”×’×“×¨×•×ª ××ª×§×“××•×ª</div>
        
        <div class="acc c-red"><div class="acc-head" onclick="tog('f1')">âš ï¸ ××œ×¨×’×™×•×ª <span>â–¾</span></div><div id="f1" class="acc-body danger">
            <input type="checkbox" id="a-milk" class="chip save"><label for="a-milk" class="lbl">ğŸ¥› ×—×œ×‘</label>
            <input type="checkbox" id="a-gluten" class="chip save"><label for="a-gluten" class="lbl">ğŸ ×’×œ×•×˜×Ÿ</label>
            <input type="checkbox" id="a-nuts" class="chip save"><label for="a-nuts" class="lbl">ğŸŒ° ××’×•×–×™×</label>
            <input type="checkbox" id="a-peanuts" class="chip save"><label for="a-peanuts" class="lbl">ğŸ¥œ ×‘×•×˜× ×™×</label>
            <input type="checkbox" id="a-soy" class="chip save"><label for="a-soy" class="lbl">ğŸ¥¢ ×¡×•×™×”</label>
            <input type="checkbox" id="a-sesame" class="chip save"><label for="a-sesame" class="lbl">ğŸ¥¯ ×©×•××©×•×</label>
            <input type="checkbox" id="a-eggs" class="chip save"><label for="a-eggs" class="lbl">ğŸ¥š ×‘×™×¦×™×</label>
            <input type="checkbox" id="a-fish" class="chip save"><label for="a-fish" class="lbl">ğŸŸ ×“×’×™×</label>
            <input type="checkbox" id="a-sulfites" class="chip save"><label for="a-sulfites" class="lbl">ğŸ· ×¡×•×œ×¤×™×˜×™×</label>
        </div></div>

        <div class="acc c-red"><div class="acc-head" onclick="tog('f2')">ğŸ¥ ×¨×¤×•××™ <span>â–¾</span></div><div id="f2" class="acc-body danger">
            <input type="checkbox" id="d-diabetic" class="chip save"><label for="d-diabetic" class="lbl">ğŸ’‰ ×¡×•×›×¨×ª</label>
            <input type="checkbox" id="d-heart" class="chip save"><label for="d-heart" class="lbl">ğŸ«€ ×œ×‘/×œ×—×¥ ×“×</label>
            <input type="checkbox" id="d-celiac" class="chip save"><label for="d-celiac" class="lbl">ğŸŒ¾ ×¦×œ×™××§</label>
            <input type="checkbox" id="d-gout" class="chip save"><label for="d-gout" class="lbl">ğŸ¦¶ ×’××•×˜</label>
            <input type="checkbox" id="d-kidney" class="chip save"><label for="d-kidney" class="lbl">ğŸ©º ×›×œ×™×•×ª</label>
            <input type="checkbox" id="d-reflux" class="chip save"><label for="d-reflux" class="lbl">ğŸ”¥ ×¦×¨×‘×ª</label>
            <input type="checkbox" id="d-anemia" class="chip save"><label for="d-anemia" class="lbl">ğŸ©¸ ×× ××™×”</label>
        </div></div>

        <div class="acc c-purple"><div class="acc-head" onclick="tog('f3')">ğŸ‘¶ ×¨×’×™×©×•×™×•×ª <span>â–¾</span></div><div id="f3" class="acc-body danger">
            <input type="checkbox" id="x-preg" class="chip save"><label for="x-preg" class="lbl">ğŸ¤° ×”×¨×™×•×Ÿ</label>
            <input type="checkbox" id="x-baby" class="chip save"><label for="x-baby" class="lbl">ğŸ¼ ×ª×™× ×•×§×•×ª</label>
            <input type="checkbox" id="x-elderly" class="chip save"><label for="x-elderly" class="lbl">ğŸ‘´ ×’×™×œ ×©×œ×™×©×™</label>
        </div></div>

        <div class="acc c-blue"><div class="acc-head" onclick="tog('f4')">âš¡ ×¡×¤×•×¨×˜ <span>â–¾</span></div><div id="f4" class="acc-body safe">
            <input type="checkbox" id="p-protein" class="chip save"><label for="p-protein" class="lbl">ğŸ’ª ×—×œ×‘×•×Ÿ ×’×‘×•×”</label>
            <input type="checkbox" id="p-bulk" class="chip save"><label for="p-bulk" class="lbl">ğŸ¦ ××¡×”</label>
            <input type="checkbox" id="p-cut" class="chip save"><label for="p-cut" class="lbl">âœ‚ï¸ ×—×™×˜×•×‘</label>
            <input type="checkbox" id="p-energy" class="chip save"><label for="p-energy" class="lbl">ğŸ”‹ ×× ×¨×’×™×”</label>
        </div></div>

        <div class="acc c-gold"><div class="acc-head" onclick="tog('f5')">âœ¡ï¸ ×“×ª <span>â–¾</span></div><div id="f5" class="acc-body safe">
            <input type="checkbox" id="k-kosher" class="chip save"><label for="k-kosher" class="lbl">ğŸ“œ ×›×©×¨</label>
            <input type="checkbox" id="k-badatz" class="chip save"><label for="k-badatz" class="lbl">âœ¨ ×‘×“"×¥</label>
            <input type="checkbox" id="k-parve" class="chip save"><label for="k-parve" class="lbl">ğŸ ×¤×¨×•×•×”</label>
            <input type="checkbox" id="k-halal" class="chip save"><label for="k-halal" class="lbl">â˜ªï¸ ×—×œ××œ</label>
            <input type="checkbox" id="k-passover" class="chip save"><label for="k-passover" class="lbl">ğŸš« ×œ×¤×¡×—</label>
        </div></div>

        <div class="acc c-blue"><div class="acc-head" onclick="tog('f6')">ğŸ¥— ×¢×¨×›×™× <span>â–¾</span></div><div id="f6" class="acc-body safe">
            <input type="checkbox" id="b-israel" class="chip save" checked><label for="b-israel" class="lbl">ğŸ‡®ğŸ‡± ×ª×•×¦×¨×ª ×”××¨×¥</label>
            <input type="checkbox" id="l-vegan" class="chip save"><label for="l-vegan" class="lbl">ğŸŒ± ×˜×‘×¢×•× ×™</label>
            <input type="checkbox" id="l-keto" class="chip save"><label for="l-keto" class="lbl">ğŸ¥‘ ×§×˜×•</label>
            <input type="checkbox" id="l-paleo" class="chip save"><label for="l-paleo" class="lbl">ğŸ– ×¤×œ×™××•</label>
            <input type="checkbox" id="c-clean" class="chip save"><label for="c-clean" class="lbl">ğŸ§ª ×ª×•×•×™×ª × ×§×™×™×”</label>
            <input type="checkbox" id="c-sugar" class="chip save"><label for="c-sugar" class="lbl">ğŸ­ ×œ×œ× ×¡×•×›×¨</label>
        </div></div>
    </div>

    <div id="scanner-overlay">
        <div id="reader"></div>
        <div class="scan-ui">
            <div style="text-align:center; color:white; margin-top:40px; font-weight:600;">×›×•×•×Ÿ ××ª ×”××¦×œ××” ×œ×‘×¨×§×•×“</div>
            <div class="scan-frame"></div>
            <button class="close-cam" onclick="stopCamera()">×¡×’×•×¨ ××¦×œ××”</button>
        </div>
    </div>

    <div class="action-bar">
        <button class="bar-btn" onclick="manualSearch()">âŒ¨ï¸</button>
        <button class="scan-trigger" onclick="startCamera()">
            <svg class="svg-scan" viewBox="0 0 24 24" width="32" height="32"><path d="M17 3H21C21.5523 3 22 3.44772 22 4V8C22 8.55228 21.5523 9 21 9C20.4477 9 20 8.55228 20 8V5H17C16.4477 5 16 4.55228 16 4C16 3.44772 16.4477 3 17 3ZM7 3H3C2.44772 3 2 3.44772 2 4V8C2 8.55228 2.44772 9 3 9C3.55228 9 4 8.55228 4 8V5H7C7.55228 5 8 4.55228 8 4C8 3.44772 7.55228 3 7 3ZM17 21H21C21.5523 21 22 20.5523 22 20V16C22 15.4477 21.5523 15 21 15C20.4477 15 20 15.4477 20 16V19H17C16.4477 19 16 19.4477 16 20C16 20.5523 16.4477 21 17 21ZM7 21H3C2.44772 21 2 20.5523 2 20V16C2 15.4477 2.44772 15 3 15C3.55228 15 4 15.4477 4 16V19H7C7.55228 19 8 19.4477 8 20C8 20.5523 7.55228 21 7 21ZM2 12C2 11.4477 2.44772 11 3 11H21C21.5523 11 22 11.4477 22 12C22 12.5523 21.5523 13 21 13H3C2.44772 13 2 12.5523 2 12Z"/></svg>
        </button>
        <button class="bar-btn" onclick="alert('×‘×§×¨×•×‘')">ğŸ•’</button>
    </div>

    <div id="settings-layer">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2 style="margin:0">×”×’×“×¨×•×ª</h2>
            <button onclick="toggleSettings()" style="background:none; border:none; color:#666; font-size:24px;">&times;</button>
        </div>
        <input type="number" id="u-w" class="clean-inp" placeholder="××©×§×œ (×§×’)">
        <input type="number" id="u-h" class="clean-inp" placeholder="×’×•×‘×” (×¡×)">
        <input type="number" id="u-age" class="clean-inp" placeholder="×’×™×œ">
        <input type="number" id="u-fat" class="clean-inp" placeholder="% ×©×•××Ÿ">
        <select id="u-gender" class="clean-inp"><option value="male">×’×‘×¨</option><option value="female">××™×©×”</option></select>
        <select id="u-target" class="clean-inp"><option value="maintain">×©××™×¨×”</option><option value="cut">×—×™×˜×•×‘</option><option value="bulk">××¡×”</option></select>
        <button onclick="saveProfile()" class="clean-inp" style="background:#fff; color:#000; font-weight:800; margin-top:20px;">×©××•×¨</button>
    </div>

    <div id="sheet-wrapper">
        <div id="sheet-overlay" onclick="closeSheet()"></div>
        <div id="bottom-sheet">
            <div style="width:40px; height:4px; background:#333; margin:0 auto 20px auto; border-radius:10px;"></div>
            <div class="prod-header">
                <img id="p-img" class="prod-thumb" src="" onerror="this.style.display='none'">
                <div style="flex:1">
                    <div id="p-brand" style="font-size:11px; color:#888; font-weight:700;"></div>
                    <input type="text" id="p-name" class="editable-name" value="×©× ×”××•×¦×¨">
                    <div style="font-size:10px; color:#666; margin-top:2px;">×œ×—×¥ ×¢×œ ×”×©× ×œ×¢×¨×™×›×” ×× ×”×•× ×©×’×•×™</div>
                </div>
                <div id="p-score" class="score-circle">--</div>
            </div>
            <div id="bio-res" class="analysis-box"></div>
            <div id="filter-res" style="margin-top:10px;"></div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;">
                <button class="clean-inp" style="background:#222;" onclick="runSniper()">ğŸ¯ ×”×©×•×•××ª ××—×™×¨</button>
                <button class="clean-inp" style="background:rgba(0,230,118,0.2); color:#00e676;" onclick="addToCart()">ğŸ›’ ×”×•×¡×£ ×œ×¡×œ</button>
            </div>
        </div>
    </div>

    <script>
        // --- VIBE OS 25.0 FINAL CORE ---
        let user={w:75,h:175,age:30,gender:'male',target:'maintain',activity:1.2,metaAge:30,visceral:5,tdee:2000};
        let cart=0;

        window.onload=()=>{ loadUser(); };
        function tog(id){ document.getElementById(id).classList.toggle('open'); }
        function toggleSettings(){ document.body.classList.toggle('settings-active'); }
        function closeSheet(){ document.getElementById('sheet-wrapper').classList.remove('active-sheet'); }
        const chk=(id)=>document.getElementById(id).checked;

        function loadUser(){
            const u=localStorage.getItem('vibe25');
            if(u) user=JSON.parse(u);
            updateDash();
            document.querySelectorAll('.save').forEach(el=>{
                el.addEventListener('change',()=>localStorage.setItem(el.id,el.checked));
                if(localStorage.getItem(el.id)==='true') el.checked=true;
            });
        }

        function saveProfile(){
            const v=(id)=>document.getElementById(id).value;
            if(v('u-w')) user.w=Number(v('u-w'));
            if(v('u-h')) user.h=Number(v('u-h'));
            if(v('u-age')) user.age=Number(v('u-age'));
            user.gender=v('u-gender');
            user.target=v('u-target');
            
            let bmr=10*user.w+6.25*user.h-5*user.age+(user.gender==='male'?5:-161);
            user.tdee=Math.round(bmr*user.activity);
            if(user.target==='cut') user.tdee-=500;
            if(user.target==='bulk') user.tdee+=300;
            
            localStorage.setItem('vibe25',JSON.stringify(user));
            updateDash();
            toggleSettings();
        }

        function updateDash(){
            document.getElementById('d-cals').innerText=user.tdee;
            document.getElementById('d-goal').innerText=(user.target==='cut'?'×—×™×˜×•×‘':(user.target==='bulk'?'××¡×”':'×©××™×¨×”'));
        }

        // CAMERA
        const html5QrCode = new Html5Qrcode("reader");
        function startCamera(){
            document.getElementById('scanner-overlay').style.display='block';
            html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:250},(txt)=>{
                stopCamera(); analyze(txt);
            }).catch(()=>{ alert("××™×Ÿ ×’×™×©×” ×œ××¦×œ××”"); stopCamera(); });
        }
        function stopCamera(){
            html5QrCode.stop().then(()=>document.getElementById('scanner-overlay').style.display='none');
        }
        function manualSearch(){
            const n=prompt("×©× ×”××•×¦×¨:");
            if(n){
                document.getElementById('sheet-wrapper').classList.add('active-sheet');
                document.getElementById('p-name').value=n;
                document.getElementById('p-brand').innerText="×—×™×¤×•×© ×™×“× ×™";
                document.getElementById('bio-res').innerText="××™×Ÿ × ×ª×•× ×™× ×œ×—×™×¤×•×© ×™×“× ×™";
            }
        }

        // --- THE FULL TITAN LOGIC RESTORED ---
        async function analyze(code){
            document.getElementById('sheet-wrapper').classList.add('active-sheet');
            document.getElementById('p-name').value="×˜×•×¢×Ÿ...";
            document.getElementById('p-score').innerText="--";
            
            try {
                const res = await fetch(`https://world.openfoodfacts.org/api/v2/product/${code}.json`);
                const data = await res.json();
                if(data.status!==1) throw new Error();
                
                const p=data.product;
                document.getElementById('p-name').value = p.product_name_he || p.product_name || "××•×¦×¨ ×›×œ×œ×™";
                document.getElementById('p-brand').innerText = p.brands || "";
                document.getElementById('p-img').src = p.image_front_small_url || "";

                // Analysis
                const n=p.nutriments||{};
                const txt=(p.ingredients_text||"")+(p.labels||"")+(p.categories||"");
                const low=txt.toLowerCase();
                const tags=(p._keywords||[]).join(" ").toLowerCase();
                const add=(p.additives_tags||[]).join(" ");
                
                let score=100;
                let flags=[];
                let info=[];

                const crit=(id,keys,msg)=>{
                    if(chk(id)){
                        for(let k of keys) if(low.includes(k)||tags.includes(k)){ score=0; flags.push(msg); return; }
                    }
                };

                // ALL FILTER GROUPS
                crit('a-milk',['milk','lait','×—×œ×‘','whey'],'â›” ×—×œ×‘');
                crit('a-gluten',['gluten','wheat','×—×™×˜×”','barley','rye'],'â›” ×’×œ×•×˜×Ÿ');
                crit('a-nuts',['nut','almond','××’×•×–','cashew','pecan'],'â›” ××’×•×–×™×');
                crit('a-peanuts',['peanut','×‘×•×˜× ×™×'],'â›” ×‘×•×˜× ×™×');
                crit('a-soy',['soy','×¡×•×™×”'],'â›” ×¡×•×™×”');
                crit('a-sesame',['sesame','×©×•××©×•×'],'â›” ×©×•××©×•×');
                crit('a-eggs',['egg','oeuf','×‘×™×¦×™×'],'â›” ×‘×™×¦×™×');
                crit('a-fish',['fish','×“×’'],'â›” ×“×’×™×');
                crit('a-sulfites',['sulfite','e220','e224'],'â›” ×¡×•×œ×¤×™×˜×™×');

                if(chk('d-diabetic') && (n.sugars_100g>5 || n.carbohydrates_100g>50)) { score-=50; flags.push("âš ï¸ ×¡×•×›×¨/×¤×—××™××” ×’×‘×•×”×”"); }
                if(chk('d-heart') && (n.salt_100g>1 || n['saturated-fat_100g']>4)) { score-=40; flags.push("âš ï¸ × ×ª×¨×Ÿ/×©×•××Ÿ ×¨×•×•×™ ×’×‘×•×”"); }
                if(chk('d-celiac') && (low.includes('wheat')||low.includes('gluten'))) { score=0; flags.push("â›” ×—×©×© ×’×œ×•×˜×Ÿ"); }
                if(chk('d-gout') && (low.includes('liver')||low.includes('yeast'))) { score=0; flags.push("â›” ×¤×•×¨×™× ×™× ×’×‘×•×”×™×"); }
                if(chk('d-kidney') && n.potassium_100g>0.3) { score-=40; flags.push("âš ï¸ ××©×œ×’×Ÿ ×’×‘×•×”"); }
                if(chk('d-reflux') && (low.includes('spice')||low.includes('tomato')||low.includes('citrus'))) { score-=30; flags.push("âš ï¸ ×—×•××¦×™×•×ª/×—×¨×™×¤×•×ª"); }
                
                if(chk('x-preg') && (low.includes('caffeine')||low.includes('alcohol'))) { score=0; flags.push("â›” ×§×¤××™×Ÿ/××œ×›×•×”×•×œ"); }
                if(chk('x-baby') && (n.sugars_100g>2 || n.salt_100g>0.5)) { score=0; flags.push("â›” ×œ× ×œ×ª×™× ×•×§×•×ª"); }
                
                if(chk('k-parve') && (low.includes('milk')||low.includes('meat'))) { score=0; flags.push("â›” ×œ× ×¤×¨×•×•×”"); }
                if(chk('k-halal') && (low.includes('pork')||low.includes('alcohol'))) { score=0; flags.push("â›” ×—×¨××"); }
                if(chk('l-vegan') && (low.includes('milk')||low.includes('egg')||low.includes('honey'))) { score=0; flags.push("â›” ×œ× ×˜×‘×¢×•× ×™"); }
                if(chk('l-paleo') && (low.includes('sugar')||low.includes('grain'))) { score=0; flags.push("â›” ×œ× ×¤×œ×™××•"); }
                if(chk('l-keto') && n.carbohydrates_100g>10) { score=0; flags.push("â›” ×¤×—××™××” ×’×‘×•×”×”"); }
                
                if(chk('c-clean') && (add.includes('e2')||add.includes('e6'))) { score-=20; flags.push("ğŸ§ª ×ª×•×¡×¤×™× ××œ××›×•×ª×™×™×"); }
                if(chk('k-kosher') && !low.includes('kosher') && !low.includes('×›×©×¨')) { score-=10; flags.push("âš ï¸ ××™×Ÿ ×¡×™××•×Ÿ ×›×©×¨×•×ª"); }
                
                const cal=n['energy-kcal_100g']||0;
                if(user.target==='cut' && cal>280) { score-=30; flags.push(`ğŸ“‰ ×¦×¤×•×£ ×§×œ×•×¨×™×ª (${cal})`); }
                if(user.visceral>9 && n['saturated-fat_100g']>3) { score-=25; flags.push("ğŸ©¸ ×©×•××Ÿ ×‘×˜× ×™ ×’×‘×•×”"); }
                if(user.target==='bulk' && n.proteins_100g>10) { score+=10; info.push("ğŸ’ª ×¢×©×™×¨ ×‘×—×œ×‘×•×Ÿ"); }

                if(chk('b-israel')) {
                    if(!code.startsWith('729')) { score-=10; flags.push("ğŸŒ ×™×‘×•×"); }
                    else { score+=5; info.push("ğŸ‡®ğŸ‡± ×ª×•×¦×¨×ª ×”××¨×¥"); }
                }

                if(score<0) score=0; if(score>100) score=100;
                
                document.getElementById('p-score').innerText = score+"%";
                document.getElementById('p-score').style.borderColor = score>70?'var(--primary)':(score>40?'var(--gold)':'var(--danger)');
                document.getElementById('p-score').style.color = document.getElementById('p-score').style.borderColor;
                
                document.getElementById('bio-res').innerHTML = `
                    <div style="display:flex; justify-content:space-between; font-weight:700;">
                        <span>${cal} ×§×§"×œ</span>
                        <span>${n.proteins_100g||0}g ×—×œ×‘×•×Ÿ</span>
                    </div>
                    <div style="color:#888; margin-top:5px;">××”×•×•×” ${Math.round((cal/user.tdee)*100)}% ××”×ª×§×¦×™×‘ ×”×™×•××™</div>
                `;
                
                let h="";
                if(flags.length) h+=flags.map(f=>`<div style="color:#ff5555; margin-top:5px;">${f}</div>`).join('');
                if(info.length) h+=info.map(i=>`<div style="color:#00e676; margin-top:5px;">${i}</div>`).join('');
                if(!h) h=`<div style="color:#00e676; margin-top:5px;">âœ¨ ××•×¦×¨ ×ª×•×× ××•×©×œ×</div>`;
                document.getElementById('filter-res').innerHTML = h;

            } catch(e){ 
                document.getElementById('p-name').value="×œ× × ××¦× - ×”×§×œ×“ ×©× ×›××Ÿ"; 
                document.getElementById('bio-res').innerText="×¡×¨×•×§ ×©×•×‘ ××• ×”×§×œ×“ ×™×“× ×™×ª";
            }
        }

        function runSniper(){
            const n = document.getElementById('p-name').value;
            if(!n) return;
            window.open(`https://www.google.com/search?q=${encodeURIComponent(n+" ××—×™×¨ site:.il")}`, '_blank');
        }
        function addToCart(){
            cart++; document.getElementById('d-cart').innerText=cart;
            closeSheet();
        }
    </script>
</body>
</html>
