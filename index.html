<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vibe OS 15.1 - Smart Name</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        :root { 
            --neon-blue: #2979ff; --neon-green: #00e676; --neon-red: #ff1744; 
            --neon-gold: #ffd600; --neon-purple: #d500f9;
            --bg: #000000; --panel: #111; --text: #f0f0f0;
        }
        
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; padding-bottom: 160px; }
        
        /* HEADER */
        .header {
            background: rgba(10,10,10,0.95); backdrop-filter: blur(10px);
            padding: 15px 20px; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 50;
            display: flex; justify-content: space-between; align-items: center;
        }
        .brand { font-size: 20px; font-weight: 900; letter-spacing: 1px; color: var(--neon-green); text-transform: uppercase; }
        .ver { font-size: 10px; color: #666; border: 1px solid #333; padding: 2px 6px; border-radius: 4px; vertical-align: middle; margin-right: 5px; }
        .sync-btn { 
            font-size: 11px; background: rgba(41, 121, 255, 0.1); color: var(--neon-blue); 
            padding: 8px 12px; border-radius: 20px; border: 1px solid var(--neon-blue); cursor: pointer; font-weight: bold;
        }

        /* SCANNER */
        #reader { width: 100%; height: 350px; background: #000; border-bottom: 2px solid var(--neon-green); display:none; }

        /* DASHBOARD */
        .bio-dash { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 15px; }
        .bio-card { 
            background: #151515; padding: 15px; border-radius: 16px; text-align: center; border: 1px solid #222; position: relative; 
        }
        .bio-card.main { grid-column: span 2; background: linear-gradient(160deg, #151515, #222); border-color: #444; }
        .bio-val { font-size: 28px; font-weight: 800; color: white; margin-bottom: 2px; }
        .bio-lbl { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .edit-icon { position: absolute; top: 10px; left: 10px; font-size: 14px; color: #555; cursor: pointer; }

        /* PROFILE EDITOR */
        #profile-editor { 
            display: none; background: #111; padding: 20px; margin: 15px; border-radius: 20px; border: 1px solid var(--neon-blue); 
            animation: fadeIn 0.3s;
        }
        .sec-head { font-size: 12px; color: var(--neon-blue); margin: 15px 0 8px 0; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .row { display: flex; gap: 10px; margin-bottom: 10px; }
        .inp { 
            flex: 1; background: #000; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; 
            text-align: center; font-size: 14px; outline: none; transition: 0.2s;
        }
        .inp:focus { border-color: var(--neon-blue); }
        .btn-save { width: 100%; background: var(--neon-blue); color: white; padding: 15px; border-radius: 12px; border:none; font-weight:bold; margin-top:15px; cursor: pointer; }

        /* FILTERS ACCORDION */
        .filters { padding: 0 15px; }
        .acc { margin-bottom: 8px; border: 1px solid #222; background: #111; border-radius: 12px; overflow: hidden; }
        .acc-head { 
            padding: 15px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            border-right: 4px solid transparent; transition: 0.2s;
        }
        .acc-body { display: none; padding: 15px; background: #050505; flex-wrap: wrap; gap: 8px; border-top: 1px solid #222; }
        .acc-body.open { display: flex; }

        /* CATEGORY COLORS */
        .c-red .acc-head { border-right-color: var(--neon-red); }
        .c-blue .acc-head { border-right-color: var(--neon-blue); }
        .c-green .acc-head { border-right-color: var(--neon-green); }
        .c-gold .acc-head { border-right-color: var(--neon-gold); }
        .c-purple .acc-head { border-right-color: var(--neon-purple); }

        /* CHIPS */
        .chip { display: none; }
        .lbl {
            padding: 8px 14px; background: #1a1a1a; border: 1px solid #333; border-radius: 20px; 
            font-size: 12px; cursor: pointer; color: #999; transition: 0.2s; user-select: none;
        }
        .chip:checked + .lbl { background: #333; color: white; border-color: #777; font-weight: bold; transform: scale(1.05); }
        .danger .chip:checked + .lbl { border-color: var(--neon-red); color: var(--neon-red); background: rgba(255, 23, 68, 0.1); }
        .safe .chip:checked + .lbl { border-color: var(--neon-green); color: var(--neon-green); background: rgba(0, 230, 118, 0.1); }

        /* DOCK */
        .dock {
            position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(10,10,10,0.95); padding: 15px;
            border-top: 1px solid #333; display: flex; gap: 10px; z-index: 100; box-shadow: 0 -5px 30px rgba(0,0,0,0.7);
        }
        .scan-inp { flex: 1; background: #000; border: 1px solid #444; color: white; padding: 14px; text-align: center; border-radius: 12px; font-size: 16px; outline: none; }
        .scan-btn { background: var(--neon-green); color: #000; border: none; padding: 0 25px; border-radius: 12px; font-weight: 900; cursor: pointer; font-size: 16px; }

        /* RESULTS MODAL */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 200; backdrop-filter: blur(8px); }
        .card {
            position: absolute; bottom: 0; width: 100%; background: #181818; border-radius: 30px 30px 0 0; padding: 30px; box-sizing: border-box;
            box-shadow: 0 -10px 60px rgba(0,0,0,0.9); animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); max-height: 85vh; overflow-y: auto;
        }
        
        .score-circle {
            width: 80px; height: 80px; border-radius: 50%; border: 4px solid #333; margin: 0 auto 15px auto;
            display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: white;
        }
        
        .analysis-box { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 16px; margin: 20px 0; font-size: 14px; line-height: 1.6; border: 1px solid #2a2a2a; }
        .actions { display: flex; gap: 10px; margin-top: 20px; }
        .act-btn { flex: 1; padding: 15px; border-radius: 12px; border: none; font-size: 12px; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand">Vibe OS <span class="ver">15.1</span></div>
        <button class="sync-btn" onclick="toggleEdit()">âš™ï¸ ×¡× ×›×¨×•×Ÿ</button>
    </div>

    <div id="reader"></div>

    <div class="bio-dash">
        <div class="bio-card main">
            <span class="edit-icon" onclick="toggleEdit()">âœï¸</span>
            <span class="bio-val" id="d-cals">...</span>
            <span class="bio-lbl">×ª×§×¦×™×‘ ×§×œ×•×¨×™ (TDEE)</span>
        </div>
        <div class="bio-card">
            <span class="bio-val" id="d-goal">...</span>
            <span class="bio-lbl">××˜×¨×”</span>
        </div>
        <div class="bio-card">
            <span class="bio-val" id="d-fat">...</span>
            <span class="bio-lbl">% ×©×•××Ÿ</span>
        </div>
    </div>

    <div id="profile-editor">
        <div class="sec-head">× ×ª×•× ×™× ××™×©×™×™×</div>
        <div class="row">
            <input type="number" id="u-w" class="inp" placeholder="××©×§×œ (×§×’)">
            <input type="number" id="u-h" class="inp" placeholder="×’×•×‘×” (×¡×)">
        </div>
        <div class="row">
            <input type="number" id="u-age" class="inp" placeholder="×’×™×œ">
            <select id="u-gender" class="inp">
                <option value="male">×’×‘×¨</option>
                <option value="female">××™×©×”</option>
            </select>
        </div>

        <div class="sec-head">××“×“×™× (××”××©×§×œ)</div>
        <div class="row">
            <input type="number" id="u-fat" class="inp" placeholder="% ×©×•××Ÿ">
            <input type="number" id="u-meta" class="inp" placeholder="×’×™×œ ××˜×‘×•×œ×™">
            <input type="number" id="u-visceral" class="inp" placeholder="×©×•××Ÿ ×‘×˜× ×™">
        </div>

        <div class="sec-head">××˜×¨×”</div>
        <div class="row">
            <select id="u-activity" class="inp" style="flex:2">
                <option value="1.2">×™×•×©×‘× ×™ (××©×¨×“)</option>
                <option value="1.375">×¤×¢×™×œ ×§×œ</option>
                <option value="1.55">×¤×¢×™×œ ×‘×™× ×•× ×™</option>
                <option value="1.725">×¤×¢×™×œ ×××•×“</option>
            </select>
             <select id="u-target" class="inp">
                <option value="maintain">×©××™×¨×”</option>
                <option value="cut">×—×™×˜×•×‘ (-500)</option>
                <option value="bulk">××¡×” (+300)</option>
            </select>
        </div>
        <button class="btn-save" onclick="saveProfile()">×©××•×¨ ×•×—×©×‘ ××—×“×©</button>
    </div>

    <div class="filters">

        <div class="acc c-red">
            <div class="acc-head" onclick="tog('f1')">âš ï¸ ××œ×¨×’×™×•×ª (×¦×™×•×Ÿ 0) <span>â–¾</span></div>
            <div id="f1" class="acc-body danger">
                <input type="checkbox" id="a-milk" class="chip save"><label for="a-milk" class="lbl">ğŸ¥› ×—×œ×‘</label>
                <input type="checkbox" id="a-gluten" class="chip save"><label for="a-gluten" class="lbl">ğŸ ×’×œ×•×˜×Ÿ</label>
                <input type="checkbox" id="a-nuts" class="chip save"><label for="a-nuts" class="lbl">ğŸŒ° ××’×•×–×™×</label>
                <input type="checkbox" id="a-peanuts" class="chip save"><label for="a-peanuts" class="lbl">ğŸ¥œ ×‘×•×˜× ×™×</label>
                <input type="checkbox" id="a-soy" class="chip save"><label for="a-soy" class="lbl">ğŸ¥¢ ×¡×•×™×”</label>
                <input type="checkbox" id="a-sesame" class="chip save"><label for="a-sesame" class="lbl">ğŸ¥¯ ×©×•××©×•×</label>
                <input type="checkbox" id="a-eggs" class="chip save"><label for="a-eggs" class="lbl">ğŸ¥š ×‘×™×¦×™×</label>
                <input type="checkbox" id="a-fish" class="chip save"><label for="a-fish" class="lbl">ğŸŸ ×“×’×™×</label>
            </div>
        </div>

        <div class="acc c-red">
            <div class="acc-head" onclick="tog('f2')">ğŸ¥ ×¨×¤×•××™ ×•××—×œ×•×ª <span>â–¾</span></div>
            <div id="f2" class="acc-body danger">
                <input type="checkbox" id="d-diabetic" class="chip save"><label for="d-diabetic" class="lbl">ğŸ’‰ ×¡×•×›×¨×ª</label>
                <input type="checkbox" id="d-heart" class="chip save"><label for="d-heart" class="lbl">ğŸ«€ ×œ×‘/×œ×—×¥ ×“×</label>
                <input type="checkbox" id="d-celiac" class="chip save"><label for="d-celiac" class="lbl">ğŸŒ¾ ×¦×œ×™××§</label>
                <input type="checkbox" id="d-gout" class="chip save"><label for="d-gout" class="lbl">ğŸ¦¶ ×’××•×˜</label>
                <input type="checkbox" id="d-reflux" class="chip save"><label for="d-reflux" class="lbl">ğŸ”¥ ×¦×¨×‘×ª</label>
            </div>
        </div>

        <div class="acc c-gold">
            <div class="acc-head" onclick="tog('f5')">âœ¡ï¸ ×“×ª ×•×›×©×¨×•×ª <span>â–¾</span></div>
            <div id="f5" class="acc-body safe">
                <input type="checkbox" id="k-kosher" class="chip save"><label for="k-kosher" class="lbl">ğŸ“œ ×›×©×¨</label>
                <input type="checkbox" id="k-badatz" class="chip save"><label for="k-badatz" class="lbl">âœ¨ ×‘×“"×¥</label>
                <input type="checkbox" id="k-parve" class="chip save"><label for="k-parve" class="lbl">ğŸ ×¤×¨×•×•×”</label>
                <input type="checkbox" id="k-halal" class="chip save"><label for="k-halal" class="lbl">â˜ªï¸ ×—×œ××œ</label>
                <input type="checkbox" id="k-passover" class="chip save"><label for="k-passover" class="lbl">ğŸš« ×œ×¤×¡×—</label>
            </div>
        </div>

        <div class="acc c-green">
            <div class="acc-head" onclick="tog('f6')">ğŸ¥— ×œ×™×™×£ ×¡×˜×™×™×œ ×•×¢×¨×›×™× <span>â–¾</span></div>
            <div id="f6" class="acc-body safe">
                <input type="checkbox" id="l-vegan" class="chip save"><label for="l-vegan" class="lbl">ğŸŒ± ×˜×‘×¢×•× ×™</label>
                <input type="checkbox" id="c-clean" class="chip save"><label for="c-clean" class="lbl">ğŸ§ª ×ª×•×•×™×ª × ×§×™×™×”</label>
                <input type="checkbox" id="c-sugar" class="chip save"><label for="c-sugar" class="lbl">ğŸ­ ×œ×œ× ×¡×•×›×¨</label>
                <input type="checkbox" id="b-israel" class="chip save" checked><label for="b-israel" class="lbl">ğŸ‡®ğŸ‡± ×ª×•×¦×¨×ª ×”××¨×¥</label>
            </div>
        </div>

    </div>

    <div class="dock">
        <input type="number" id="barcode" class="scan-inp" placeholder="×”×§×œ×“ ××• ×¡×¨×•×§ ×‘×¨×§×•×“...">
        <button class="scan-btn" onclick="startCamera()">ğŸ“· ×¡×¨×•×§</button>
    </div>

    <div id="modal">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <div>
                    <h2 id="p-name" style="margin:0; font-size:20px; color:white;"></h2>
                    <p id="p-brand" style="color:#888; margin:5px 0 0 0; font-size:13px;"></p>
                </div>
                <button onclick="closeModal()" style="background:none; border:none; color:#666; font-size:28px;">&times;</button>
            </div>

            <div style="margin:20px 0; text-align:center;">
                <div id="score-circle" class="score-circle">--%</div>
                <div style="font-size:12px; color:#aaa;">×”×ª×××” ×œ×¤×¨×•×¤×™×œ</div>
            </div>

            <div id="bio-res" class="analysis-box"></div>
            <div id="filter-res" style="font-size:13px; padding:0 10px;"></div>

            <div class="actions">
                <button class="act-btn" style="background:#222; color:#ccc;" onclick="alert('××—×¤×© ××—×™×¨×™×...')"><span>ğŸ”</span> ×”×©×•×•××”</button>
                <button class="act-btn" style="background:rgba(0,230,118,0.1); color:var(--neon-green);" onclick="alert('× ×•×¡×£ ×œ×¡×œ!')"><span>ğŸ›’</span> ×”×•×¡×¤×”</button>
                <button class="act-btn" style="background:rgba(41,121,255,0.1); color:var(--neon-blue);" onclick="alert('×ª×•×¢×“.')"><span>ğŸ›¡ï¸</span> ×ª×™×¢×•×“</button>
            </div>
        </div>
    </div>

    <script>
        // --- System Logic ---
        function tog(id) { document.getElementById(id).classList.toggle('open'); }
        function toggleEdit() { const el = document.getElementById('profile-editor'); el.style.display = el.style.display === 'block' ? 'none' : 'block'; }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        function chk(id) { return document.getElementById(id).checked; }
        const getVal = (id) => Number(document.getElementById(id).value);

        // --- Persistence ---
        document.querySelectorAll('.save').forEach(el => {
            el.addEventListener('change', () => localStorage.setItem(el.id, el.checked));
            if(localStorage.getItem(el.id) === 'true') el.checked = true;
        });

        // --- Biometric Engine ---
        let user = { w: 75, h: 175, age: 30, gender: 'male', target: 'maintain', activity: 1.2, metaAge: 30, fat: 18, visceral: 5, tdee: 2000 };

        if(localStorage.getItem('userProfile')) {
            user = JSON.parse(localStorage.getItem('userProfile'));
            updateDash();
        }

        function calcTDEE() {
            let bmr = 10 * user.w + 6.25 * user.h - 5 * user.age;
            bmr += (user.gender === 'male') ? 5 : -161;
            let tdee = bmr * user.activity;

            if (user.metaAge < user.age) tdee += 100;
            if (user.fat < 12 && user.gender === 'male') tdee += 150;

            if(user.target === 'cut') tdee -= 500;
            if(user.target === 'bulk') tdee += 300;

            user.tdee = Math.round(tdee);
            updateDash();
            localStorage.setItem('userProfile', JSON.stringify(user));
        }

        function updateDash() {
            document.getElementById('d-cals').innerText = user.tdee;
            document.getElementById('d-fat').innerText = user.fat + "%";
            const maps = {cut:'×—×™×˜×•×‘', maintain:'×©××™×¨×”', bulk:'××¡×”'};
            document.getElementById('d-goal').innerText = maps[user.target];
        }

        function saveProfile() {
            if(getVal('u-w')) user.w = getVal('u-w');
            if(getVal('u-h')) user.h = getVal('u-h');
            if(getVal('u-age')) user.age = getVal('u-age');
            if(getVal('u-meta')) user.metaAge = getVal('u-meta');
            if(getVal('u-fat')) user.fat = getVal('u-fat');
            if(getVal('u-visceral')) user.visceral = getVal('u-visceral');
            user.gender = document.getElementById('u-gender').value;
            user.target = document.getElementById('u-target').value;
            user.activity = Number(document.getElementById('u-activity').value);
            
            calcTDEE();
            toggleEdit();
        }

        // --- Camera Engine (Poco Fix) ---
        const html5QrCode = new Html5Qrcode("reader");
        const config = { fps: 15, qrbox: { width: 250, height: 150 } };

        function startCamera() {
            document.getElementById('reader').style.display = 'block';
            html5QrCode.start({ facingMode: "environment" }, config, (decodedText) => {
                document.getElementById('barcode').value = decodedText;
                html5QrCode.stop().then(() => {
                    document.getElementById('reader').style.display = 'none';
                    analyze(decodedText);
                });
            }).catch(err => { alert("×× × ××©×¨ ××¦×œ××” ×‘×“×¤×“×¤×Ÿ."); });
        }

        // --- THE MASTER ALGORITHM (Smart Name + Scoring) ---
        async function analyze(inputCode) {
            const code = inputCode || document.getElementById('barcode').value;
            if(!code) return alert("×”×–×Ÿ ×‘×¨×§×•×“");

            document.getElementById('modal').style.display = 'block';
            document.getElementById('p-name').innerText = "××—×©×‘ ×”×ª×××”...";
            document.getElementById('bio-res').innerHTML = "";
            document.getElementById('filter-res').innerHTML = "";

            try {
                const res = await fetch(`https://world.openfoodfacts.org/api/v2/product/${code}.json`);
                const data = await res.json();
                
                if(data.status !== 1) { document.getElementById('p-name').innerText = "××•×¦×¨ ×œ× ×–×•×”×”"; return; }

                const p = data.product;
                
                // *** SMART NAME LOGIC (FIX 15.1) ***
                let finalName = p.product_name_he || p.product_name || p.generic_name_he || p.generic_name || "";
                if(!finalName) {
                    if(p.brands) finalName = "××•×¦×¨ ×©×œ " + p.brands;
                    else finalName = "××•×¦×¨ ××–×•×”×” (×œ×œ× ×©×)";
                }
                document.getElementById('p-name').innerText = finalName;
                document.getElementById('p-brand').innerText = p.brands || "";

                // Data Normalization
                const n = p.nutriments || {};
                const txt = (p.ingredients_text || "").toLowerCase() + " " + (p.labels || "").toLowerCase();
                const tags = (p._keywords || []).join(" ").toLowerCase();
                const additives = (p.additives_tags || []).join(" ");

                // --- SCORING SYSTEM START (100 Base) ---
                let score = 100;
                let flags = [];
                let info = [];

                // 1. Critical Filters
                const checkCritical = (id, keywords, msg) => {
                    if(chk(id)) {
                        for(let k of keywords) {
                            if(txt.includes(k) || tags.includes(k)) {
                                score = 0;
                                flags.push(`â›” ${msg}`);
                                return true;
                            }
                        }
                    }
                    return false;
                };

                checkCritical('a-milk', ['milk', 'lait', '×—×œ×‘', 'whey'], '××›×™×œ ×—×œ×‘');
                checkCritical('a-gluten', ['gluten', 'wheat', 'barley', 'rye', '×—×™×˜×”'], '××›×™×œ ×’×œ×•×˜×Ÿ');
                checkCritical('a-nuts', ['nut', 'almond', 'cashew', 'walnut', 'pecan', '××’×•×–'], '××›×™×œ ××’×•×–×™×');
                checkCritical('a-peanuts', ['peanut', '×‘×•×˜× ×™×'], '××›×™×œ ×‘×•×˜× ×™×');
                
                // 2. Penalties
                if(chk('d-diabetic') && (n.sugars_100g > 5)) { score -= 50; flags.push("âš ï¸ ×¡×•×›×¨ ×’×‘×•×” (×¡×•×›×¨×ª)"); }
                if(chk('d-heart') && (n.salt_100g > 1)) { score -= 40; flags.push("âš ï¸ × ×ª×¨×Ÿ ×’×‘×•×” (×œ×‘)"); }
                
                if(chk('k-parve') && (txt.includes('milk') || txt.includes('meat'))) { score = 0; flags.push("â›” ××™× ×• ×¤×¨×•×•×”"); }
                if(chk('k-halal') && (txt.includes('pork') || txt.includes('alcohol'))) { score = 0; flags.push("â›” ××™× ×• ×—×œ××œ"); }
                
                if(chk('c-clean') && (additives.includes('e2') || additives.includes('e621'))) {
                    score -= 20;
                    flags.push("ğŸ§ª ××›×™×œ ×—×•××¨×™× ××©××¨×™×");
                }

                // 3. Biometric TDEE
                const cal = n['energy-kcal_100g'] || 0;
                const dailyPct = Math.round((cal / user.tdee) * 100);
                
                if(user.target === 'cut') {
                    if(cal > 280) { score -= 30; flags.push(`ğŸ“‰ ×¦×¤×•×£ ×§×œ×•×¨×™×ª (${cal} ×§×§"×œ)`); }
                    else { info.push("âœ… ×“×œ ×§×œ×•×¨×™×•×ª - ×˜×•×‘ ×œ×—×™×˜×•×‘"); }
                } 

                if(user.visceral > 9 && (n['saturated-fat_100g'] > 3 || n.salt_100g > 1)) {
                    score -= 25;
                    flags.push("ğŸ©¸ ×©×•××Ÿ ×‘×˜× ×™ ×’×‘×•×”: ×”××•×¦×¨ ×¢×ª×™×¨ ×©×•××Ÿ/× ×ª×¨×Ÿ");
                }

                // 4. Values
                if(chk('b-israel') && !code.startsWith('729')) { score -= 10; flags.push("ğŸŒ ××™× ×• ×ª×•×¦×¨×ª ×”××¨×¥"); }
                if(chk('b-israel') && code.startsWith('729')) { score += 5; info.push("ğŸ‡®ğŸ‡± ×ª×•×¦×¨×ª ×”××¨×¥"); }

                // Final Score
                if(score < 0) score = 0;
                if(score > 100) score = 100;

                const circle = document.getElementById('score-circle');
                circle.innerText = score + "%";
                circle.style.borderColor = score > 70 ? 'var(--neon-green)' : (score > 40 ? 'var(--neon-gold)' : 'var(--neon-red)');
                circle.style.color = circle.style.borderColor;

                document.getElementById('bio-res').innerHTML = `
                    <div>×¢×¨×š ×§×œ×•×¨×™: <strong>${cal}</strong> ×§×§"×œ (100×’')</div>
                    <div style="font-size:12px; color:#888;">××”×•×•×” ${dailyPct}% ××”×ª×§×¦×™×‘ ×”×™×•××™ ×©×œ×š</div>
                `;

                let fHTML = "";
                if(flags.length > 0) fHTML += `<div style="margin-bottom:15px;">${flags.map(f=>`<div style="color:#ff8a80; border-bottom:1px solid #333; padding:5px;">${f}</div>`).join('')}</div>`;
                if(info.length > 0) fHTML += `<div style="margin-bottom:15px;">${info.map(i=>`<div style="color:#69f0ae; padding:5px;">${i}</div>`).join('')}</div>`;
                document.getElementById('filter-res').innerHTML = fHTML;

            } catch(e) { console.error(e); alert("×©×’×™××” ×‘× ×™×ª×•×—"); }
        }

        calcTDEE();
    </script>
</body>
</html>
