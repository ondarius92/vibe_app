<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe OS - Debug Mode</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { background-color: #000; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        
        #reader { width: 100%; max-width: 600px; height: 400px; border: 2px solid #333; background: #111; }
        
        /* ××–×•×¨ ×œ×•×’×™× ×œ×¤×ª×¨×•×Ÿ ×ª×§×œ×•×ª */
        #debug-log { 
            width: 90%; height: 100px; background: #222; color: #ff3131; 
            overflow-y: scroll; margin-top: 20px; padding: 10px; font-family: monospace; border: 1px solid #444; font-size: 12px;
        }

        .btn { background: #0B7517; color: white; padding: 15px 30px; font-size: 18px; border: none; border-radius: 50px; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <h2 style="color: #0B7517;">Vibe Scanner Test</h2>
    
    <div id="reader"></div>

    <button class="btn" id="startBtn" onclick="startCamera()">×”×¤×¢×œ ××¦×œ××”</button>

    <div id="debug-log">×™×•××Ÿ ××¢×¨×›×ª: ×××ª×™×Ÿ ×œ×”×¤×¢×œ×”...</div>

    <script>
        function log(msg) {
            const logDiv = document.getElementById('debug-log');
            logDiv.innerHTML += "<br>> " + msg;
            console.log(msg);
        }

        function onScanSuccess(decodedText, decodedResult) {
            // ×”×¦×œ×—×”!
            log("âœ… ×‘×¨×§×•×“ ×–×•×”×”: " + decodedText);
            alert("×”×¦×œ×—×”! ×§×•×“: " + decodedText);
            html5QrcodeScanner.clear();
        }

        function onScanFailure(error) {
            // ×”×ª×¢×œ× ××©×’×™××•×ª ×¡×¨×™×§×” ×¨×’×™×œ×•×ª (×§×•×¨×” ×›×©××™×Ÿ ×‘×¨×§×•×“ ××•×œ ×”××¦×œ××”)
        }

        function startCamera() {
            document.getElementById('startBtn').style.display = 'none';
            log("×× ×¡×” ×œ×‘×§×© ×’×™×©×” ×œ××¦×œ××”...");

            const html5QrCode = new Html5Qrcode("reader");
            
            // ×× ×¡×” ×§×•×“× ××ª ×”××¦×œ××” ×”××—×•×¨×™×ª, ×× × ×›×©×œ - ×¢×•×‘×¨ ×œ×›×œ ××¦×œ××” ×–××™× ×”
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            
            // × ×™×¡×™×•×Ÿ 1: ××¦×œ××” ××—×•×¨×™×ª (×œ×˜×œ×¤×•× ×™×)
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess, onScanFailure)
            .then(() => {
                log("××¦×œ××” ××—×•×¨×™×ª ×”×•×¤×¢×œ×” ×‘×”×¦×œ×—×”!");
            })
            .catch(err => {
                log("âš ï¸ ××¦×œ××” ××—×•×¨×™×ª × ×›×©×œ×” (" + err + "). ×× ×¡×” ××¦×œ××ª ××©×ª××© (×œ×¤×˜×•×¤)...");
                
                // × ×™×¡×™×•×Ÿ 2: ××¦×œ××ª ××©×ª××© (×œ×¤×˜×•×¤×™×)
                html5QrCode.start({ facingMode: "user" }, config, onScanSuccess, onScanFailure)
                .then(() => {
                    log("××¦×œ××ª ×œ×¤×˜×•×¤ ×”×•×¤×¢×œ×”!");
                })
                .catch(err2 => {
                    log("âŒ ×©×’×™××” ×§×¨×™×˜×™×ª: " + err2);
                    log("×¤×ª×¨×•×Ÿ: ×‘×“×•×§ ×”×¨×©××•×ª ×“×¤×“×¤×Ÿ ×œ××¢×œ×” ××©×××œ ğŸ”’");
                    document.getElementById('startBtn').style.display = 'block';
                });
            });
        }
    </script>

</body>
</html>
