<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#020617">
    <title>Vibe OS: THE SINGULARITY</title>
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* ==========================================================================
           SECTION 1: SUPREME NEON-PLASMA DESIGN SYSTEM
           ========================================================================== */
        :root {
            /* --- COLOR DEPTH ARCHITECTURE --- */
            --bg-void: #000000;
            --bg-deep-space: #020617;
            --bg-glass-morphism: rgba(15, 23, 42, 0.9);
            --bg-card-monolith: rgba(30, 41, 59, 0.75);
            
            /* --- BORDER & RADIANCE TOKENS --- */
            --border-standard: rgba(255, 255, 255, 0.1);
            --border-active-neon: rgba(99, 102, 241, 0.7);
            --shadow-titan-glow: 0 0 30px rgba(99, 102, 241, 0.4);
            
            /* --- THE PLASMA SPECTRUM --- */
            --plasma-primary: #4f46e5; /* Electric Indigo */
            --plasma-secondary: #06b6d4; /* Cyber Cyan */
            --plasma-accent: #8b5cf6; /* Royal Violet */
            --gradient-titan-prime: linear-gradient(135deg, var(--plasma-primary), var(--plasma-secondary));
            --gradient-nebula-animated: radial-gradient(circle at center, var(--plasma-primary) 0%, transparent 85%);

            /* --- GRADING SPECTRUM (TITAN MASTER CALIBRATION) --- */
            --g-ap: #39ff14; /* A+ Neon Radiant Green */
            --g-a: #22c55e;  /* Pure Bio Green */
            --g-bp: #ccff00; /* Neon Lime (B+) */
            --g-b: #a3e635;  /* Balanced Yellow-Green */
            --g-c: #facc15;  /* Warning Yellow */
            --g-d: #fb923c;  /* Alert Orange */
            --g-e: #ff0000;  /* Absolute Critical Red (E) */

            /* --- CATEGORY LOGIC MAPPING --- */
            --color-medical-veto: #f43f5e;
            --color-dietary-logic: #3b82f6;
            --color-kosher-standard: #eab308;
            --color-ethics-protocol: #10b981;
            --color-sensory-matrix: #ff66cc;
            --color-chemical-avoidance: #a855f7;

            /* --- PHYSICAL DIMENSIONS --- */
            --app-max-width: 500px;
            --app-radius-supreme: 56px;
            --font-main: 'Rubik', sans-serif;
            --dock-height: 100px;
            --transition-supreme: 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* ==========================================================================
           SECTION 2: QUANTUM NEBULA ENGINE 7.0
           ========================================================================== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            user-select: none;
        }

        html, body {
            height: 100vh;
            width: 100vw;
            background-color: #000;
            color: #f8fafc;
            font-family: var(--font-main);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nebula-monolith-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            background: var(--bg-deep-space);
            overflow: hidden;
            pointer-events: none;
        }
        
        .nebula-monolith-bg::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url('https://grainy-gradients.vercel.app/noise.svg');
            opacity: 0.22;
            mix-blend-mode: overlay;
        }

        .orb-quantum-fluid {
            position: absolute;
            border-radius: 50%;
            filter: blur(140px);
            opacity: 0.5;
            will-change: transform, opacity;
            animation: titanOrbFlow 25s infinite alternate ease-in-out;
        }

        .orb-1 { width: 900px; height: 900px; background: var(--plasma-primary); top: -30%; left: -30%; }
        .orb-2 { width: 800px; height: 800px; background: var(--plasma-secondary); bottom: -25%; right: -25%; animation-delay: -10s; }
        .orb-3 { width: 500px; height: 500px; background: var(--plasma-accent); top: 35%; left: 35%; opacity: 0.2; animation-delay: -18s; }

        @keyframes titanOrbFlow {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: translate(150px, 80px) scale(1.2) rotate(140deg); opacity: 0.6; }
            100% { transform: translate(-80px, 150px) scale(0.9) rotate(280deg); opacity: 0.3; }
        }

        /* ==========================================================================
           SECTION 3: SUPREME BOOT SEQUENCE
           ========================================================================== */
        #master-boot-engine {
            position: fixed;
            inset: 0;
            background: var(--bg-void);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.8s var(--transition-supreme);
        }

        .boot-glitch-logo {
            font-size: 82px;
            font-weight: 950;
            letter-spacing: 15px;
            background: var(--gradient-titan-prime);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titanRadiance 3s infinite cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .boot-progress-system {
            width: 300px;
            height: 2px;
            background: rgba(255,255,255,0.04);
            border-radius: 40px;
            overflow: hidden;
            margin-top: 60px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        .boot-progress-bar {
            height: 100%;
            width: 0%;
            background: var(--plasma-secondary);
            box-shadow: 0 0 40px var(--plasma-secondary);
            animation: bootDeployment 4s forwards cubic-bezier(0.22, 1, 0.36, 1);
        }

        .boot-terminal-log {
            margin-top: 35px;
            font-size: 13px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 6px;
            font-weight: 800;
        }

        @keyframes bootDeployment { 0% { width: 0%; } 100% { width: 100%; } }
        @keyframes titanRadiance { 0%,100% { filter: blur(0) brightness(1.2); transform: scale(1); } 50% { filter: blur(8px) brightness(1.8); opacity: 0.5; transform: scale(0.97); } }

        /* ==========================================================================
           SECTION 4: ARCHITECT VIEWPORT SYSTEM
           ========================================================================== */
        #master-app-monolith {
            width: 100%;
            max-width: var(--app-max-width);
            height: 100%;
            max-height: 97vh;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(80px);
            -webkit-backdrop-filter: blur(80px);
            border: 1px solid var(--border-standard);
            border-radius: var(--app-radius-supreme);
            box-shadow: 0 0 0 16px #000, 0 60px 180px rgba(0,0,0,1);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateY(60px) scale(0.96);
            transition: 1.6s var(--transition-supreme);
        }

        #master-app-monolith.deployed {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        @media (max-width: 480px) {
            #master-app-monolith {
                max-width: 100%;
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
                border: none;
            }
        }

        /* SCROLL ENGINE CORE */
        #master-scroll-viewport {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: var(--safe-area-bottom);
            scrollbar-width: none;
            scroll-behavior: smooth;
            padding-top: 10px;
        }
        #master-scroll-viewport::-webkit-scrollbar { display: none; }

        /* ==========================================================================
           SECTION 5: MASTER HEADER & COMMAND CENTER
           ========================================================================== */
        .master-navigation-header {
            padding: 40px 45px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(2, 6, 23, 0.92);
            border-bottom: 1px solid var(--border-standard);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(25px);
        }

        .master-logo-brand {
            font-size: 32px;
            font-weight: 1000;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .master-logo-brand span {
            background: var(--gradient-titan-prime);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-style: italic;
        }

        .master-config-btn {
            width: 60px;
            height: 60px;
            border-radius: 22px;
            background: var(--bg-glass);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.06);
            transition: 0.5s var(--transition-supreme);
            color: #fff;
            font-size: 26px;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.05);
        }

        .master-config-btn:active {
            transform: scale(0.75) rotate(25deg);
            background: rgba(255,255,255,0.2);
            border-color: var(--plasma-cyan);
            box-shadow: 0 0 35px rgba(6, 182, 212, 0.5);
        }

        /* ==========================================================================
           SECTION 6: ADVANCED BI DASHBOARD
           ========================================================================== */
        .analytics-grid {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .titan-bi-card {
            background: var(--bg-card-monolith);
            border: 1px solid var(--border-standard);
            border-radius: 44px;
            padding: 35px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 165px;
            cursor: pointer;
            transition: 0.6s var(--transition-supreme);
            position: relative;
            overflow: hidden;
        }

        .titan-bi-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(165deg, transparent, rgba(255,255,255,0.06));
            opacity: 0;
            transition: 0.6s;
        }

        .titan-bi-card:hover {
            border-color: var(--border-active-neon);
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
        }
        
        .titan-bi-card:hover::after { opacity: 1; }

        .titan-bi-card:active {
            transform: scale(0.95);
        }
        
        .bi-card-hero {
            grid-column: 1 / -1;
            flex-direction: row;
            align-items: center;
            border-left: 12px solid var(--plasma-indigo);
            background: linear-gradient(160deg, #1e293b, #020617);
        }

        .bi-card-quality {
            grid-column: 1 / -1;
            min-height: 195px;
            border-right: 12px solid var(--g-ap);
            background: linear-gradient(160deg, #1e293b, #020617);
        }

        /* BI Typography Matrix */
        .titan-bi-label {
            font-size: 13px;
            font-weight: 1000;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 5px;
            margin-bottom: 14px;
        }

        .titan-bi-value {
            font-size: 44px;
            font-weight: 1000;
            color: #fff;
            letter-spacing: -3px;
            line-height: 0.85;
        }

        .titan-bi-meta {
            font-size: 16px;
            color: var(--plasma-cyan);
            font-weight: 800;
            margin-top: 15px;
            letter-spacing: 1.5px;
        }

        /* QUANTUM GAUGE 8.0 */
        .quantum-gauge-track {
            width: 100%;
            height: 18px;
            background: rgba(0,0,0,0.85);
            border-radius: 10px;
            margin-top: 35px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255,255,255,0.12);
        }

        .quantum-gauge-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--g-e), var(--g-c), var(--g-a), var(--g-ap));
            transition: width 2.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 35px rgba(57, 255, 20, 0.4);
        }
        
        /* Floating Intelligence Badge */
        .intelligence-orb-badge {
            position: absolute;
            top: 32px;
            left: 32px;
            width: 92px;
            height: 92px;
            border-radius: 50%;
            border: 8px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            font-weight: 1000;
            transition: 1s var(--transition-supreme);
            box-shadow: 0 0 70px rgba(0,0,0,1);
            background: rgba(0,0,0,0.6);
            z-index: 10;
        }

        /* LOOKUP MATRIX ENGINE UI */
        .lookup-matrix-wrap {
            padding: 20px 30px;
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .lookup-input-architect {
            flex: 1;
            background: var(--bg-glass);
            border: 1px solid var(--border-standard);
            padding: 28px;
            border-radius: 36px;
            color: #fff;
            text-align: right;
            font-size: 22px;
            transition: 0.6s var(--transition-supreme);
            font-family: var(--font-main);
            font-weight: 700;
            box-shadow: inset 0 6px 20px rgba(0,0,0,0.5);
        }

        .lookup-input-architect:focus {
            border-color: var(--plasma-cyan);
            background: #000;
            box-shadow: 0 0 50px rgba(6, 182, 212, 0.5);
            transform: scale(1.03);
        }

        .lookup-btn-execute {
            width: 90px;
            background: var(--gradient-titan-prime);
            border: none;
            border-radius: 36px;
            font-size: 36px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 25px 60px rgba(99, 102, 241, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.5s var(--transition-supreme);
        }

        .lookup-btn-execute:active {
            transform: scale(0.78) translateY(12px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
        }

        .dashboard-bi-pills {
            padding: 35px 45px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .titan-intelligence-pill {
            font-size: 14px;
            padding: 14px 26px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 30px;
            color: #fff;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: 0.4s;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }

        /* ==========================================================================
           7. MASTER DOCK ARCHITECTURE (FIXED)
           ========================================================================== */
        .dock-monolith-fixed-wrap {
            position: absolute;
            bottom: 50px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            z-index: 1000;
            pointer-events: none;
        }

        .dock-monolith-glass-base {
            pointer-events: auto;
            width: 95%;
            max-width: 480px;
            height: 105px;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(50px);
            border-radius: 46px;
            border: 1px solid rgba(255,255,255,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 75px;
            box-shadow: 0 50px 120px rgba(0,0,0,1);
        }
        
        .dock-monolith-icon {
            font-size: 38px;
            color: #64748b;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .dock-monolith-icon span {
            font-size: 13px;
            font-weight: 1000;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.9;
        }

        .dock-monolith-icon:active {
            color: #fff;
            transform: translateY(-20px) scale(1.3);
        }

        .dock-monolith-icon.is-active {
            color: var(--plasma-cyan);
            text-shadow: 0 0 35px var(--plasma-cyan);
        }

        /* TITAN SUPREME SCANNER FAB v9 */
        .scanner-anchor-point {
            position: relative;
            margin-top: -85px;
        }

        .scanner-fab-titan-supreme {
            width: 115px;
            height: 115px;
            border-radius: 44px;
            background: var(--gradient-titan-prime);
            border: 12px solid #020617;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 35px 90px rgba(79, 70, 229, 0.75);
            cursor: pointer;
            transform: rotate(45deg) translateY(-45px);
            transition: 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .scanner-fab-titan-supreme:active {
            transform: rotate(45deg) translateY(-45px) scale(0.7);
            box-shadow: 0 15px 35px rgba(79, 70, 229, 0.5);
        }

        .scan-viz-container {
            transform: rotate(-45deg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .vector-barcode-monolith-v9 {
            display: flex;
            gap: 7px;
            height: 42px;
            align-items: center;
        }

        .v-bar-segment {
            width: 7px;
            background: #fff;
            border-radius: 3px;
        }

        .v-bar-segment:nth-child(1) { height: 28px; }
        .v-bar-segment:nth-child(2) { height: 46px; width: 12px; }
        .v-bar-segment:nth-child(3) { height: 24px; }
        .v-bar-segment:nth-child(4) { height: 38px; width: 6px; }

        .scan-label-monolith-v9 {
            font-size: 14px;
            font-weight: 1000;
            color: #fff;
            letter-spacing: 5px;
            text-transform: uppercase;
            text-shadow: 0 0 25px rgba(0,0,0,0.7);
        }

        /* ==========================================================================
           8. MASTER ANALYTIC SHEETS (MODALS)
           ========================================================================== */
        .titan-master-modal-layer {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 2000;
            display: none;
            flex-direction: column;
            justify-content: flex-end;
            opacity: 0;
            transition: opacity 0.6s var(--transition-supreme);
        }

        .titan-master-modal-layer.is-active {
            display: flex;
            opacity: 1;
        }

        .master-monolith-sheet {
            width: 100%;
            height: 97%;
            background: #0f172a;
            border-top-left-radius: 72px;
            border-top-right-radius: 72px;
            border-top: 4px solid rgba(255,255,255,0.35);
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 -60px 250px rgba(0,0,0,1);
        }

        .titan-master-modal-layer.is-active .master-monolith-sheet {
            transform: translateY(0);
        }

        .sheet-header-architect {
            padding: 50px 60px;
            border-bottom: 1px solid rgba(255,255,255,0.12);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.6);
        }

        .sheet-title-architect {
            font-size: 36px;
            font-weight: 1000;
            color: #fff;
            letter-spacing: -2px;
        }

        .sheet-close-architect {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.18);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.4s;
            font-size: 28px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .sheet-close-architect:active {
            transform: scale(0.7) rotate(90deg);
            background: rgba(255,255,255,0.4);
        }

        .sheet-scroll-viewport-monolith {
            padding: 45px 60px;
            overflow-y: auto;
            flex: 1;
            padding-bottom: 300px;
            scrollbar-width: none;
        }
        .sheet-scroll-viewport-monolith::-webkit-scrollbar { display: none; }

        .sheet-footer-fixed-monolith {
            padding: 45px 60px 80px 60px;
            background: #0f172a;
            border-top: 1px solid rgba(255,255,255,0.12);
            position: absolute;
            bottom: 0;
            width: 100%;
            z-index: 20;
        }

        /* ==========================================================================
           9. THE 75+ SUPREME PARAMETER ACCORDION ENGINE
           ========================================================================== */
        .param-group-titan {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.18);
            border-radius: 44px;
            margin-bottom: 30px;
            overflow: hidden;
            transition: 0.6s var(--transition-supreme);
        }

        .param-group-titan.is-open {
            border-color: var(--plasma-indigo);
            box-shadow: 0 40px 100px rgba(0,0,0,0.7);
            transform: scale(1.04);
        }

        .param-group-header {
            padding: 36px 42px;
            font-weight: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-size: 22px;
            letter-spacing: 1px;
        }

        .param-group-body {
            display: none;
            padding: 45px;
            background: rgba(0,0,0,0.7);
            border-top: 2px solid rgba(255,255,255,0.1);
            gap: 24px;
            flex-wrap: wrap;
        }

        .param-group-titan.is-open .param-group-body {
            display: flex;
        }

        .param-chip-master-input { display: none; }
        
        .param-chip-master-label {
            padding: 24px 36px;
            background: #1e293b;
            border-radius: 32px;
            font-size: 19px;
            color: #94a3b8;
            cursor: pointer;
            border: 4px solid transparent;
            transition: 0.5s var(--transition-supreme);
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 12px 25px rgba(0,0,0,0.4);
        }

        .param-chip-master-input:checked + .param-chip-master-label {
            background: rgba(99, 102, 241, 0.45);
            border-color: var(--plasma-indigo);
            color: #fff;
            font-weight: 1000;
            transform: scale(1.15) translateY(-8px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.8);
        }

        /* SUPREME CATEGORY THEMES */
        .theme-veto .param-group-header { color: var(--g-e); border-right: 12px solid var(--g-e); }
        .theme-quantum .param-group-header { color: var(--plasma-cyan); border-right: 12px solid var(--plasma-cyan); }
        .theme-standard .param-group-header { color: var(--cat-kosh); border-right: 12px solid var(--cat-kosh); }
        .theme-planet .param-group-header { color: var(--cat-ethics); border-right: 12px solid var(--cat-ethics); }
        .theme-lab .param-group-header { color: var(--color-avoidance); border-right: 12px solid var(--color-avoidance); }
        .theme-architect .param-group-header { color: var(--g-ap); border-right: 12px solid var(--g-ap); }

        /* ==========================================================================
           10. QUANTUM PRO SCANNER VIEWPORT v9 (UHD)
           ========================================================================== */
        #master-quantum-viewport-v9 {
            position: absolute;
            inset: 0;
            background: #000;
            z-index: 3000;
            display: none;
            flex-direction: column;
        }

        #master-quantum-viewport-v9.is-active {
            display: flex;
        }

        #qr-engine-v9-monolith {
            flex: 1;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: contrast(1.3) brightness(1.1) saturate(1.3);
        }

        .quantum-hud-v9 {
            position: absolute;
            inset: 0;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(rgba(0,0,0,0.8) 0%, transparent 25%, transparent 75%, rgba(0,0,0,0.8) 100%);
        }

        .quantum-frame-v9 {
            width: 400px;
            height: 400px;
            border: 6px solid rgba(255,255,255,0.3);
            border-radius: 100px;
            position: relative;
            box-shadow: 0 0 0 12000px rgba(0,0,0,0.98);
        }

        .quantum-edge-v9 {
            position: absolute;
            inset: -15px;
            border: 12px solid var(--plasma-cyan);
            border-radius: 100px;
            clip-path: polygon(0 0, 25% 0, 25% 100%, 0 100%, 0 0, 100% 0, 100% 25%, 0 25%, 0 0, 100% 0, 100% 100%, 75% 100%, 75% 0, 100% 0, 100% 100%, 0 100%, 0 75%, 100% 75%, 100% 100%, 0 100%);
        }

        .quantum-laser-v9 {
            position: absolute;
            top: 50%;
            left: 15%;
            right: 15%;
            height: 6px;
            background: var(--g-e);
            box-shadow: 0 0 80px var(--g-e), 0 0 30px #fff;
            animation: quantumPulseSweepV9 2.8s infinite ease-in-out;
            border-radius: 50%;
        }

        @keyframes quantumPulseSweepV9 {
            0%, 100% { top: 12%; opacity: 0.15; transform: scaleX(0.75); }
            50% { top: 88%; opacity: 1; transform: scaleX(1.2); }
        }

        /* ==========================================================================
           11. INTELLIGENCE OUTPUT ARCHITECTURE
           ========================================================================== */
        .grade-orb-architect-supreme {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            border: 24px solid;
            margin: 0 auto 60px;
            display: flex; align-items: center; justify-content: center;
            font-size: 106px; font-weight: 1000;
            box-shadow: 0 0 180px currentColor;
            color: #fff;
            text-shadow: 0 0 60px rgba(0,0,0,0.8);
            transition: 1s var(--transition-supreme);
        }

        .intelligence-report-monolith-v7 {
            text-align: right;
            background: rgba(255,255,255,0.1);
            padding: 45px;
            border-radius: 56px;
            border-right: 18px solid var(--plasma-cyan);
            line-height: 2.6;
            font-size: 21px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.6);
            margin-bottom: 50px;
        }

        .intelligence-row-titan {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 18px;
            font-weight: 800;
        }

        .intelligence-row-titan i { font-size: 24px; }

        /* LISTING ARCHITECTURE MASTER CLASS */
        .master-monolith-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 38px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            transition: 0.6s var(--transition-supreme);
        }

        .master-monolith-row:hover {
            background: rgba(255,255,255,0.06);
            transform: translateX(-15px) scale(1.02);
            border-color: var(--plasma-cyan);
        }

        .g-badge-supreme-titan {
            font-size: 22px;
            font-weight: 1000;
            padding: 16px 32px;
            border-radius: 20px;
            color: #000;
            min-width: 84px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
        }

        .row-supreme-details h4 { font-size: 24px; font-weight: 1000; margin-bottom: 8px; letter-spacing: -1px; }
        .row-supreme-details span { font-size: 18px; color: #64748b; font-weight: 800; }

        /* ==========================================================================
           12. THE MASTER ACTION BUTTONS
           ========================================================================== */
        .btn-architect-titan-supreme {
            width: 100%;
            padding: 32px;
            border-radius: 38px;
            font-weight: 1000;
            font-size: 26px;
            border: none;
            cursor: pointer;
            transition: 0.6s var(--transition-supreme);
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            letter-spacing: 5px;
            text-transform: uppercase;
        }

        .btn-architect-titan-supreme::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent);
            transition: 1s;
        }

        .btn-architect-titan-supreme:hover::before { left: 100%; }

        .btn-architect-titan-supreme:active {
            transform: scale(0.9) translateY(12px);
            filter: brightness(1.3);
        }

        .btn-monolith-titan-p {
            background: var(--gradient-titan-prime);
            color: #fff;
            box-shadow: 0 35px 100px rgba(79, 70, 229, 0.7);
        }

        .btn-monolith-titan-s {
            background: rgba(255,255,255,0.12);
            border: 4px solid rgba(255,255,255,0.3);
            color: #fff;
            backdrop-filter: blur(15px);
        }

        /* SUPREME NOTIFICATION ARCHITECT */
        #architect-supreme-toast {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(-350px);
            background: #1e293b;
            color: #fff;
            padding: 32px 100px;
            border-radius: 150px;
            z-index: var(--z-toast);
            border: 4px solid var(--plasma-cyan);
            font-weight: 1000;
            transition: 1.1s cubic-bezier(0.68, -0.6, 0.32, 1.6);
            box-shadow: 0 70px 200px rgba(0,0,0,1);
            white-space: nowrap;
            letter-spacing: 6px;
            text-transform: uppercase;
            font-size: 20px;
        }

        #architect-supreme-toast.is-active {
            transform: translateX(-50%) translateY(0);
        }

    </style>
</head>
<body>

<div class="nebula-monolith-bg">
    <div class="orb-quantum-fluid orb-primary"></div>
    <div class="orb-quantum-fluid orb-secondary"></div>
    <div class="orb-quantum-fluid orb-tertiary"></div>
</div>

<div id="master-boot-engine">
    <div class="boot-branding">
        <div class="boot-logo-glitch">VIBE OS</div>
    </div>
    <div class="boot-track"><div class="boot-bar-fill"></div></div>
    <div class="boot-terminal-log">SINGULARITY MONOLITH ENGAGED</div>
</div>

<div id="master-app-monolith">
    
    <div class="master-navigation-header">
        <div class="master-logo-brand">VIBE <span>SUPREME</span></div>
        <div class="master-config-btn" onclick="App.open('settings')"><i class="fa-solid fa-atom"></i></div>
    </div>

    <div id="master-scroll-viewport">
        
        <div class="bi-grid">
            
            <div class="titan-bi-card bi-card-hero" onclick="App.open('settings')">
                <div>
                    <div class="titan-bi-label">IDENTITY AUTHENTICATION</div>
                    <div id="ui-titan-user-identity" class="titan-bi-value">××•×¨×—</div>
                </div>
                <div style="text-align: left;">
                    <div class="titan-bi-label">QUANTUM ALGORITHMS</div>
                    <div id="ui-titan-filters-active-total" style="color:var(--plasma-cyan); font-weight:1000; font-size:20px;">0 ×¤×¢×™×œ×™×</div>
                </div>
            </div>

            <div class="titan-bi-card" onclick="App.open('ring')">
                <div class="titan-bi-label">BIO-METRIC MATRIX</div>
                <div id="ui-titan-bio-status-label" class="titan-bi-value" style="color:var(--g-a); font-size:36px;">×ª×§×™×Ÿ</div>
                <div class="titan-bi-meta">Quantum Bio-Sync: 100%</div>
            </div>

            <div class="titan-bi-card bi-card-quality" onclick="App.open('cart')">
                <div id="ui-titan-master-orb-grade" class="score-orb-titan-floating">A</div>
                <div style="text-align:right; width:100%;">
                    <div class="titan-bi-label">INTELLIGENCE CART PERFORMANCE</div>
                    <div id="ui-titan-score-pct-value" class="titan-bi-value">100%</div>
                    <div class="quantum-gauge-track"><div id="ui-titan-bi-gauge-fill" class="quantum-gauge-fill"></div></div>
                    <div class="titan-bi-meta"><span id="ui-titan-cart-item-count">0</span> ××•×¦×¨×™× ×××•××ª×™× ×‘×××’×¨</div>
                </div>
            </div>

        </div>

        <div class="section-title-architect-supreme" style="padding:0 45px; margin-top:30px; font-size:18px; font-weight:1000; color:#64748b; text-transform:uppercase; letter-spacing:5px; margin-bottom:20px;">×—×™×¤×•×© ×•×–×™×”×•×™ FUZZY v9</div>
        <div class="lookup-matrix-wrap">
            <input type="text" id="inp-titan-lookup-master-class" class="lookup-input-architect" placeholder="×”×§×œ×“ ×©× ××•×¦×¨, ××•×ª×’ ××• ×‘×¨×§×•×“...">
            <button class="lookup-btn-execute" onclick="Cart.executeTitanFuzzyLookup()">ğŸ”</button>
        </div>

        <div id="ui-titan-intelligence-pills" class="dashboard-bi-pills"></div>

    </div>

    <div class="dock-monolith-fixed-wrap">
        <div class="dock-monolith-glass-base">
            
            <div class="dock-monolith-icon" onclick="App.open('cart')">
                <i class="fa-solid fa-basket-shopping"></i>
                <span>×¢×’×œ×”</span>
            </div>
            
            <div class="scanner-anchor-point">
                <div class="scanner-fab-titan-supreme" onclick="Scanner.deployQuantumV9()">
                    <div class="scan-viz-container">
                        <div class="vector-barcode-monolith-v9">
                            <span class="v-bar-segment"></span><span class="v-bar-segment"></span>
                            <span class="v-bar-segment"></span><span class="v-bar-segment"></span>
                        </div>
                        <div class="scan-label-monolith-v9">SCAN</div>
                    </div>
                </div>
            </div>

            <div class="dock-monolith-icon" onclick="App.open('history')">
                <i class="fa-solid fa-server"></i>
                <span>Vault</span>
            </div>

        </div>
    </div>

    <div id="architect-supreme-toast">SYSTEM SYNCHRONIZED</div>

    <div id="modal-settings" class="titan-master-modal-layer"><div class="master-monolith-sheet">
        <div class="sheet-header-architect"><div class="sheet-title-architect">TITAN PREFERENCE ENGINE v9</div><div class="sheet-close-architect" onclick="App.close('settings')">âœ•</div></div>
        <div class="sheet-scroll-viewport-monolith" id="settings-payload-matrix">
            <input type="text" id="inp-master-architect-identity" placeholder="×”×’×“×¨ ×–×”×•×ª ××¨×›×™×˜×§×˜ ×¢×œ×™×•×Ÿ" style="width:100%; padding:32px; background:rgba(255,255,255,0.1); border:none; border-radius:44px; color:#fff; margin-bottom:50px; text-align:right; font-size:28px; font-weight:1000; box-shadow: inset 0 8px 30px rgba(0,0,0,0.8);">
            
            <div class="param-group-titan theme-architect"><div class="param-group-header" onclick="App.togAcc(this)">ğŸ… ×“×™×¨×•×’ ××™×›×•×ª ×•××™××•×ª ×§×•×•× ×˜×™ <span>â–¼</span></div><div class="param-group-body">
                <input type="checkbox" id="q-aplus" class="param-chip-master-input"><label for="q-aplus" class="param-chip-master-label"><i class="fa-solid fa-crown"></i> A+ ×‘×œ×‘×“ (××¦×•×™× ×•×ª)</label>
                <input type="checkbox" id="q-green" class="param-chip-master-input"><label for="q-green" class="param-chip-master-label"><i class="fa-solid fa-circle-check"></i> ×ª×• ×™×¨×•×§ ×¨×©××™</label>
                <input type="checkbox" id="q-natural" class="param-chip-master-input"><label for="q-natural" class="param-chip-master-label"><i class="fa-solid fa-seedling"></i> 100% ×˜×‘×¢×™</label>
                <input type="checkbox" id="q-nored" class="param-chip-master-input"><label for="q-nored" class="param-chip-master-label"><i class="fa-solid fa-ban"></i> ×œ×œ× ××“×‘×§×•×ª ××“×•××•×ª</label>
                <input type="checkbox" id="q-nova" class="param-chip-master-input"><label for="q-nova" class="param-chip-master-label"><i class="fa-solid fa-microscope"></i> NOVA 1-2 (×¢×™×‘×•×“ × ××•×š)</label>
                <input type="checkbox" id="q-pest" class="param-chip-master-input"><label for="q-pest" class="param-chip-master-label"><i class="fa-solid fa-bug-slash"></i> ×œ×œ× ×—×•××¨×™ ×”×“×‘×¨×”</label>
                <input type="checkbox" id="q-micro" class="param-chip-master-input"><label for="q-micro" class="param-chip-master-label"><i class="fa-solid fa-dna"></i> ×œ×œ× ×”× ×“×¡×” ×’× ×˜×™×ª</label>
                <input type="checkbox" id="q-plast" class="param-chip-master-input"><label for="q-plast" class="param-chip-master-label"><i class="fa-solid fa-bottle-water"></i> ×œ×œ× ××™×§×¨×•-×¤×œ×¡×˜×™×§</label>
            </div></div>

            <div class="param-group-titan theme-veto"><div class="param-group-header" onclick="App.togAcc(this)">âš ï¸ ××œ×¨×’×™×•×ª (MEDICAL VETO) <span>â–¼</span></div><div class="param-group-body">
                <input type="checkbox" id="a-milk" class="param-chip-master-input"><label for="a-milk" class="param-chip-master-label">×—×œ×‘</label>
                <input type="checkbox" id="a-gluten" class="param-chip-master-input"><label for="a-gluten" class="param-chip-master-label">×’×œ×•×˜×Ÿ (×—×™×˜×”)</label>
                <input type="checkbox" id="a-nuts" class="param-chip-master-input"><label for="a-nuts" class="param-chip-master-label">××’×•×–×™ ×¢×¥</label>
                <input type="checkbox" id="a-peanuts" class="param-chip-master-input"><label for="a-peanuts" class="param-chip-master-label">×‘×•×˜× ×™×</label>
                <input type="checkbox" id="a-sesame" class="param-chip-master-input"><label for="a-sesame" class="param-chip-master-label">×©×•××©×•×</label>
                <input type="checkbox" id="a-soy" class="param-chip-master-input"><label for="a-soy" class="param-chip-master-label">×¡×•×™×”</label>
                <input type="checkbox" id="a-eggs" class="param-chip-master-input"><label for="a-eggs" class="param-chip-master-label">×‘×™×¦×™×</label>
                <input type="checkbox" id="a-fish" class="param-chip-master-input"><label for="a-fish" class="param-chip-master-label">×“×’×™×</label>
                <input type="checkbox" id="a-shell" class="param-chip-master-input"><label for="a-shell" class="param-chip-master-label">×¤×™×¨×•×ª ×™×</label>
                <input type="checkbox" id="a-mustard" class="param-chip-master-input"><label for="a-mustard" class="param-chip-master-label">×—×¨×“×œ</label>
                <input type="checkbox" id="a-celery" class="param-chip-master-input"><label for="a-celery" class="param-chip-master-label">×¡×œ×¨×™</label>
                <input type="checkbox" id="a-sulfites" class="param-chip-master-input"><label for="a-sulfites" class="param-chip-master-label">×¡×•×œ×¤×™×˜×™×</label>
                <input type="checkbox" id="a-lupin" class="param-chip-master-input"><label for="a-lupin" class="param-chip-master-label">×ª×•×¨××•×¡</label>
                <input type="checkbox" id="a-corn" class="param-chip-master-input"><label for="a-corn" class="param-chip-master-label">×ª×™×¨×¡</label>
                <input type="checkbox" id="a-beans" class="param-chip-master-input"><label for="a-beans" class="param-chip-master-label">×¤×•×œ (G6PD)</label>
            </div></div>

            <div class="param-group-titan theme-veto"><div class="param-group-header" onclick="App.togAcc(this)">ğŸ¥ ××¦×‘ ×¨×¤×•××™ (×•×˜×• ×—××•×¨) <span>â–¼</span></div><div class="param-group-body">
                <input type="checkbox" id="m-diabetes" class="param-chip-master-input"><label for="m-diabetes" class="param-chip-master-label"><i class="fa-solid fa-syringe"></i> ×¡×•×›×¨×ª (×•×˜×• ×¡×•×›×¨)</label>
                <input type="checkbox" id="m-celiac" class="param-chip-master-input"><label for="m-celiac" class="param-chip-master-label"><i class="fa-solid fa-wheat-exclamation"></i> ×¦×œ×™××§ (×•×˜×• ×’×œ×•×˜×Ÿ)</label>
                <input type="checkbox" id="m-pressure" class="param-chip-master-input"><label for="m-pressure" class="param-chip-master-label"><i class="fa-solid fa-heart-pulse"></i> ×œ×—×¥ ×“× (×•×˜×• × ×ª×¨×Ÿ)</label>
                <input type="checkbox" id="m-heart" class="param-chip-master-input"><label for="m-heart" class="param-chip-master-label"><i class="fa-solid fa-heart-broken"></i> ×‘×¨×™××•×ª ×”×œ×‘ (×•×˜×• ×©×•××Ÿ)</label>
                <input type="checkbox" id="m-kidney" class="param-chip-master-input"><label for="m-kidney" class="param-chip-master-label"><i class="fa-solid fa-stethoscope"></i> ×›×œ×™×•×ª (××©×œ×’×Ÿ/×–×¨×—×Ÿ)</label>
                <input type="checkbox" id="m-gout" class="param-chip-master-input"><label for="m-gout" class="param-chip-master-label"><i class="fa-solid fa-bone"></i> ×’××•×˜ (×—×•××¦×ª ×©×ª×Ÿ)</label>
                <input type="checkbox" id="m-ibs" class="param-chip-master-input"><label for="m-ibs" class="param-chip-master-label"><i class="fa-solid fa-pills"></i> ××¢×™ ×¨×’×™×– (FODMAP)</label>
                <input type="checkbox" id="m-reflux" class="param-chip-master-input"><label for="m-reflux" class="param-chip-master-label"><i class="fa-solid fa-fire-burner"></i> ×¦×¨×‘×ª / ×¨×™×¤×œ×•×§×¡</label>
                <input type="checkbox" id="m-chol" class="param-chip-master-input"><label for="m-chol" class="param-chip-master-label"><i class="fa-solid fa-burger"></i> ×›×•×œ×¡×˜×¨×•×œ ×’×‘×•×”</label>
                <input type="checkbox" id="m-migraine" class="param-chip-master-input"><label for="m-migraine" class="param-chip-master-label"><i class="fa-solid fa-head-side-virus"></i> ××™×’×¨× ×•×ª</label>
            </div></div>

            <div class="param-group-titan theme-quantum"><div class="param-group-header" onclick="App.togAcc(this)">ğŸ¥— ×“×™××˜×” ×•××•×¨×— ×—×™×™× <span>â–¼</span></div><div class="param-group-body">
                <input type="checkbox" id="l-vegan" class="param-chip-master-input"><label for="l-vegan" class="param-chip-master-label">×˜×‘×¢×•× ×™</label>
                <input type="checkbox" id="l-veg" class="param-chip-master-input"><label for="l-veg" class="param-chip-master-label">×¦××—×•× ×™</label>
                <input type="checkbox" id="l-keto" class="param-chip-master-input"><label for="l-keto" class="param-chip-master-label">×§×˜×• (Keto)</label>
                <input type="checkbox" id="l-paleo" class="param-chip-master-input"><label for="l-paleo" class="param-chip-master-label">×¤×œ×™××• (Paleo)</label>
                <input type="checkbox" id="l-lowcarb" class="param-chip-master-input"><label for="l-lowcarb" class="param-chip-master-label">×“×œ ×¤×—××™××”</label>
                <input type="checkbox" id="l-organic" class="param-chip-master-input"><label for="l-organic" class="param-chip-master-label">××•×¨×’× ×™</label>
                <input type="checkbox" id="l-clean" class="param-chip-master-input"><label for="l-clean" class="param-chip-master-label">×ª×•×•×™×ª × ×§×™×™×” (Clean Label)</label>
                <input type="checkbox" id="l-whole30" class="param-chip-master-input"><label for="l-whole30" class="param-chip-master-label">Whole30</label>
            </div></div>

            <div class="param-group-titan theme-lab"><div class="param-group-header" onclick="App.togAcc(this)">ğŸ§ª ×¨×›×™×‘×™× ×œ×”×™×× ×¢×•×ª (×›×™××™) <span>â–¼</span></div><div class="param-group-body">
                <input type="checkbox" id="x-sugar" class="param-chip-master-input"><label for="x-sugar" class="param-chip-master-label">×¡×•×›×¨ ×œ×‘×Ÿ</label>
                <input type="checkbox" id="x-proc" class="param-chip-master-input"><label for="x-proc" class="param-chip-master-label">××–×•×Ÿ ××¢×•×‘×“</label>
                <input type="checkbox" id="x-caff" class="param-chip-master-input"><label for="x-caff" class="param-chip-master-label">×§×¤××™×Ÿ</label>
                <input type="checkbox" id="x-palm" class="param-chip-master-input"><label for="x-palm" class="param-chip-master-label">×©××Ÿ ×“×§×œ×™×</label>
                <input type="checkbox" id="x-msg" class="param-chip-master-input"><label for="x-msg" class="param-chip-master-label">××•× ×•×¡×•×“×™×•× (MSG)</label>
                <input type="checkbox" id="x-trans" class="param-chip-master-input"><label for="x-trans" class="param-chip-master-label">×©×•××Ÿ ×˜×¨×× ×¡</label>
                <input type="checkbox" id="x-colors" class="param-chip-master-input"><label for="x-colors" class="param-chip-master-label">×¦×‘×¢×™ ×××›×œ</label>
                <input type="checkbox" id="x-preserv" class="param-chip-master-input"><label for="x-preserv" class="param-chip-master-label">×—×•××¨×™× ××©××¨×™×</label>
                <input type="checkbox" id="x-sweet" class="param-chip-master-input"><label for="x-sweet" class="param-chip-master-label">×××ª×™×§×™× ××œ××›×•×ª×™×™×</label>
                <input type="checkbox" id="x-hfc" class="param-chip-master-input"><label for="x-hfc" class="param-chip-master-label">×¡×™×¨×•×¤ ×ª×™×¨×¡</label>
            </div></div>

            <div class="param-group-titan theme-planet"><div class="param-group-header" onclick="App.togAcc(this)">ğŸŒ ××ª×™×§×” ×•×¡×‘×™×‘×” <span>â–¼</span></div><div class="param-group-body">
                <input type="checkbox" id="e-fair" class="param-chip-master-input"><label for="e-fair" class="param-chip-master-label">×¡×—×¨ ×”×•×’×Ÿ</label>
                <input type="checkbox" id="e-local" class="param-chip-master-input"><label for="e-local" class="param-chip-master-label">ğŸ‡®ğŸ‡± ×ª×•×¦×¨×ª ×”××¨×¥</label>
                <input type="checkbox" id="e-recycle" class="param-chip-master-input"><label for="e-recycle" class="param-chip-master-label">××¨×™×–×” ××ª×›×œ×”</label>
                <input type="checkbox" id="e-animal" class="param-chip-master-input"><label for="e-animal" class="param-chip-master-label">×œ×œ× × ×™×¡×•×™×™× ×‘×‘×¢"×—</label>
                <input type="checkbox" id="e-worker" class="param-chip-master-input"><label for="e-worker" class="param-chip-master-label">××—×¨×™×•×ª ×—×‘×¨×ª×™×ª</label>
            </div></div>

        </div>
        <div class="sheet-footer-fixed-monolith"><button class="btn-architect-titan-supreme btn-monolith-titan-p" onclick="User.deployTitanProfile()"><i class="fa-solid fa-dna"></i> ×‘×¦×¢ ×¤×¨×™×¡×ª ××¨×›×™×˜×§×˜×•×¨×”</button></div>
    </div></div>

    <div id="modal-result" class="titan-master-modal-layer"><div class="master-monolith-sheet">
        <div class="sheet-header-architect"><div>× ×™×ª×•×— TITAN ×¡×•×¤×™ v9</div><div class="sheet-close-architect" onclick="App.close('result')">âœ•</div></div>
        <div class="sheet-scroll-viewport-monolith" style="text-align:center;">
            <div id="res-titan-grade-orb" class="grade-orb-architect-supreme">A</div>
            <h2 id="res-titan-name-ui" style="font-size:48px; font-weight:1000; line-height:1; margin-bottom:15px;">×©× ××•×¦×¨</h2>
            <div id="res-titan-brand-ui" style="color:#94a3b8; font-size:24px; margin-bottom:50px; font-weight:700;">××•×ª×’ ×”××¢×¨×›×ª</div>
            <div id="res-titan-intelligence-report" class="intelligence-report-monolith-v7"></div>
            
            <div id="res-retailer-matrix" style="margin-top:50px; display:grid; grid-template-columns:1fr 1fr; gap:20px;"></div>
        </div>
        <div class="sheet-footer-fixed-monolith" style="display:grid; grid-template-columns:1fr 1fr; gap:25px;">
            <button class="btn-architect-titan-supreme btn-monolith-titan-p" onclick="Cart.addMonolithValidated(true)">+ ×œ×‘×™×ª</button>
            <button class="btn-architect-titan-supreme btn-monolith-titan-s" onclick="Cart.addMonolithValidated(false)">+ ×œ×™</button>
        </div>
    </div></div>

    <div id="modal-cart" class="titan-master-modal-layer"><div class="master-monolith-sheet">
        <div class="sheet-header-architect"><div>×¡×œ ×§× ×™×•×ª ×××•××ª v9</div><div class="sheet-close-architect" onclick="App.close('cart')">âœ•</div></div>
        <div class="sheet-scroll-viewport-monolith" id="ui-monolith-cart-payload"></div>
        <div class="sheet-footer-fixed-monolith"><button class="btn-architect-titan-supreme btn-monolith-titan-s" style="color:var(--g-e); border-color:rgba(255,0,0,0.4);" onclick="Cart.monolithPurgeAll()"><i class="fa-solid fa-trash-can"></i> ××—×™×§×ª ×¡×œ ×’×•×¨×¤×ª</button></div>
    </div></div>

    <div id="modal-history" class="titan-master-modal-layer"><div class="master-monolith-sheet">
        <div class="sheet-header-architect"><div>THE VAULT - BI v9</div><div class="sheet-close-architect" onclick="App.close('history')">âœ•</div></div>
        <div class="sheet-scroll-viewport-monolith">
            <div class="bi-vault-panel">
                <div class="bi-date-row">
                    <input type="date" id="vault-bi-start-date" class="inp-vault" onchange="History.vaultRefreshBI()">
                    <input type="date" id="vault-bi-end-date" class="inp-vault" onchange="History.vaultRefreshBI()">
                </div>
                <input type="text" id="vault-bi-search-input" class="lookup-input-architect search-vault" style="width:100%; margin-bottom:25px;" placeholder="×—×¤×© ××•×¦×¨ ××• ××•×ª×’ ×‘××¨×›×™×•×Ÿ..." onkeyup="History.vaultRefreshBI()">
                <div id="vault-bi-grade-chips-matrix" class="grade-bi-chips"></div>
                <div class="agg-mode-switch" onclick="History.toggleVaultAggregationBI()">
                    <span>ğŸ“‚ ××¦×‘ ×¦××¦×•× (BI Collapse)</span><span id="ui-agg-status-bi" style="color:var(--plasma-cyan);">OFF</span>
                </div>
            </div>
            <div id="ui-monolith-vault-payload"></div>
        </div>
    </div></div>

    <div id="modal-ring" class="titan-master-modal-layer"><div class="master-monolith-sheet" style="height:auto;">
        <div class="sheet-header-architect"><div>VIBE RING - ×‘×™×• ×¡×™× ×›×¨×•×Ÿ v9</div><div class="sheet-close-architect" onclick="App.close('ring')">âœ•</div></div>
        <div class="sheet-body" style="display:grid; grid-template-columns:1fr 1fr; gap:30px; padding:60px;">
            <button class="btn-architect-titan-supreme btn-monolith-titan-s" onclick="App.syncVibeRing('normal')">ğŸŸ¢ ×¨×’×™×œ</button>
            <button class="btn-architect-titan-supreme btn-monolith-titan-s" onclick="App.syncVibeRing('stress')">ğŸ¤¯ ×¡×˜×¨×¡</button>
            <button class="btn-architect-titan-supreme btn-monolith-titan-s" onclick="App.syncVibeRing('sick')">ğŸ¤’ ×—×•×œ×™</button>
            <button class="btn-architect-titan-supreme btn-monolith-titan-s" onclick="App.syncVibeRing('sugar')">ğŸ©¸ ×¡×•×›×¨</button>
            <button class="btn-architect-titan-supreme btn-monolith-titan-s" onclick="App.syncVibeRing('sport')">ğŸ’ª ××™××•×Ÿ</button>
            <button class="btn-architect-titan-supreme btn-monolith-titan-s" onclick="App.syncVibeRing('tired')">ğŸ˜´ ×¢×™×™×¤×•×ª</button>
        </div>
    </div></div>

    <div id="master-quantum-viewport-v9">
        <div id="qr-engine-v9-monolith"></div>
        <div class="quantum-hud-v9">
            <div class="quantum-frame-v9">
                <div class="quantum-edge-v9"></div>
                <div class="quantum-laser-v9"></div>
            </div>
        </div>
        <div style="position:absolute; bottom:80px; width:100%; display:flex; justify-content:center; z-index:5001;">
            <button onclick="Scanner.terminateV9()" style="background:rgba(0,0,0,0.8); border:4px solid rgba(255,255,255,0.5); color:#fff; padding:25px 80px; border-radius:80px; font-weight:1000; cursor:pointer; backdrop-filter:blur(30px); letter-spacing:6px; box-shadow: 0 0 60px rgba(0,0,0,1);">TERMINATE ENGINE</button>
        </div>
    </div>

</div>

<script>
    /* =========================================================================
       TITAN SUPREME MONOLITH CORE v9.5
       ARCHITECT: ABSOLUTE QUANTUM AI IMPLEMENTATION
       ========================================================================= */

    // --- 1. DATA MONOLITH (SINGLETON GENERATOR - 2500 ITEMS) ---
    const BRANDS_MONOLITH = ['×ª× ×•×‘×”','×©×˜×¨××•×¡','××¡×','×¢×œ×™×ª','×˜×¨×”','×¨××™ ×œ×•×™','×©×•×¤×¨×¡×œ','×˜×‘×¢×•×œ','×§×¨×¤×•×¨ IL','×™×•×—× × ×•×£','×•×™×§×˜×•×¨×™','× ×™×¦×ª ×”×“×•×‘×“×‘×Ÿ','×”× ××œ','×¡×•×’×ª','×•×™×¡×•×¦×§×™','×‘×œ×“×™','×˜×™×¨×ª ×¦×‘×™','×–×•×’×œ×•×‘×§','×¢×•×£ ×˜×•×‘','×××× ×¢×•×£','××—×œ×‘×•×ª ×¨××ª ×”×’×•×œ×Ÿ','×’×“','×”×©×“×”','××•×¨×’× ×™×§','×‘××“×™','××™×œ×§×™','×§×•×§×” ×§×•×œ×”','×”×™×™× ×¥','×”×œ×× ×¡','×§× ×•×¨','×¡×˜××¨×§×™×¡×˜','×¤×•×¡×™×“×•×Ÿ','×™×“ ××¨×“×›×™','×™×›×™×Ÿ','×¤×¨×™ × ×™×¨','×¡× ×¤×¨×•×¡×˜','××¢×“× ×•×ª','×©×œ×•×©×ª ×”××•×¤×™×','×‘×Ÿ ×× ×“ ×’\'×¨×™×¡','×’×•×œ×“×”','× ×‘×™×¢×•×ª','××™ ×¢×“×Ÿ'];
    
    const PRODUCTS_TITAN_PRO = [
        {n:'×œ×—× ××œ× 100%', cat:'bakery', g:'A', sugar:1.8, salt:410, tags:['gl','local','green','natural','vegan'], eNums:[]},
        {n:'×—×œ×‘ 3% ×˜×¨×™', cat:'dairy', g:'B', sugar:4.8, salt:50, tags:['da','local'], eNums:[]},
        {n:'××™×œ×§×™ ×¢× ×§×¦×¤×ª', cat:'dairy', g:'E', sugar:16, salt:75, tags:['da','sug','proc','additive'], eNums:['E407','E471']},
        {n:'××œ×¤×¤×•×Ÿ ×‘×œ××“×™ ×˜×¨×™', cat:'fresh', g:'A+', sugar:0.7, salt:2, tags:['fresh','natural','low-glycemic','green'], eNums:[]},
        {n:'×§×•×œ×” ×–×™×¨×•', cat:'drink', g:'D', sugar:0, salt:16, tags:['caff','proc','artificial'], eNums:['E150d','E950','E951']},
        {n:'×˜×—×™× ×” ×’×•×œ××™×ª ××©×•××©×•×', cat:'pantry', g:'A+', sugar:0.4, salt:12, tags:['ses','local','natural','superfood'], eNums:[]},
        {n:'×‘××‘×” ×§×œ××¡×™×ª', cat:'snack', g:'B', sugar:2.5, salt:380, tags:['nut','local'], eNums:[]},
        {n:'×©× ×™×¦×œ ×ª×™×¨×¡ ××©×¤×—×ª×™', cat:'frozen', g:'C', sugar:3.5, salt:590, tags:['gl','proc','additive'], eNums:['E461','E160c']},
        {n:'×¤×¡×˜×” ×‘×¨×™×œ×” ××§×•×¨×™', cat:'pantry', g:'B', sugar:0.9, salt:5, tags:['gl'], eNums:[]},
        {n:'×—×•××•×¡ ××¡×œ×™ ×××™×ª×™', cat:'pantry', g:'D', sugar:1.6, salt:550, tags:['proc','local','salt','additive'], eNums:['E202','E330']},
        {n:'×‘×™×¦×™× ×˜×¨×™×•×ª L', cat:'fresh', g:'A', sugar:0.3, salt:125, tags:['eggs','local','natural'], eNums:[]},
        {n:'×™×•×’×•×¨×˜ BIO ×œ×‘×Ÿ', cat:'dairy', g:'A+', sugar:3.9, salt:48, tags:['da','natural','green'], eNums:[]},
        {n:'×©×•×§×•×œ×“ ×¤×¨×” ×¢×œ×™×ª', cat:'snack', g:'E', sugar:55, salt:100, tags:['da','sug','proc'], eNums:['E476']},
        {n:'×§×¤×” × ××¡ ××’×•×¨×¢×Ÿ', cat:'drink', g:'A', sugar:0, salt:0, tags:['caff','natural'], eNums:[]},
        {n:'×ª×™×¨×¡ ××ª×•×§ ×‘×©×™××•×¨×™×', cat:'pantry', g:'C', sugar:6, salt:350, tags:['sug','local'], eNums:[]}
    ];

    let MASTER_TITAN_DB = [];
    for(let i=0; i<2500; i++) {
        const base = PRODUCTS_TITAN_PRO[i % PRODUCTS_TITAN_PRO.length];
        const brand = BRANDS_MONOLITH[i % BRANDS_MONOLITH.length];
        let g = base.g;
        if(g==='B' && Math.random()>0.5) g='B+'; 
        MASTER_TITAN_DB.push({ ...base, b: brand, fullName: `${base.n} ${brand}`, g: g, id: (7290000 + i).toString() });
    }

    // --- 2. THE ABSOLUTE STATE CONTROLLER ---
    let State = { 
        user: {name:'××•×¨×—', filters:[]}, 
        cart: [], 
        history: [], 
        ring: 'normal', 
        temp: null, 
        isAgg: false, 
        vaultGrades: [] 
    };

    const App = {
        init: function() {
            this.syncStorage();
            this.buildVaultFiltersBI();
            
            // TITAN BOOT SEQUENCE PRO
            setTimeout(() => {
                const boot = document.getElementById('master-boot-engine');
                boot.style.opacity = 0;
                setTimeout(() => { 
                    boot.remove(); 
                    document.getElementById('master-app-monolith').classList.add('deployed');
                }, 1000);
            }, 3500);
            this.monolithRefresh();
        },
        syncStorage: function() {
            const u=localStorage.getItem('vMonolith_user'); if(u) State.user=JSON.parse(u);
            const c=localStorage.getItem('vMonolith_cart'); if(c) State.cart=JSON.parse(c);
            const h=localStorage.getItem('vMonolith_hist'); if(h) State.history=JSON.parse(h);
        },
        saveMonolith: function() {
            localStorage.setItem('vMonolith_user', JSON.stringify(State.user));
            localStorage.setItem('vMonolith_cart', JSON.stringify(State.cart));
            localStorage.setItem('vMonolith_hist', JSON.stringify(State.history));
        },
        monolithRefresh: function() {
            document.getElementById('ui-titan-user-identity').innerText = State.user.name;
            document.getElementById('ui-titan-filters-active-total').innerText = State.user.filters.length + ' ×”×’×“×¨×•×ª ×¤×¢×™×œ×•×ª';
            this.updateDashboardBI();
        },
        updateDashboardBI: function() {
            const rMap = {'normal':'×ª×§×™×Ÿ','stress':'×¡×˜×¨×¡ ğŸ¤¯','sick':'×—×•×œ×™ ğŸ¤’','sugar':'× ×¤×™×œ×ª ×¡×•×›×¨ ğŸ©¸','sport':'××™××•×Ÿ ğŸ’ª','tired':'×¢×™×™×¤×•×ª ğŸ˜´'};
            document.getElementById('ui-titan-bio-status-label').innerText = rMap[State.ring] || '×ª×§×™×Ÿ';
            
            // TITAN QUALITY BI LOGIC v9
            let score=100; if(State.cart.length>0){ let t=0; State.cart.forEach(i=>t+=SCORES[i.g]||50); score=Math.round(t/State.cart.length); }
            document.getElementById('ui-titan-score-pct-value').innerText = score + '%';
            const bar = document.getElementById('ui-titan-bi-gauge-fill'); bar.style.width = score + '%';
            
            // SUPREME GRADE MAPPING
            let g='E'; if(score>=96)g='A+'; else if(score>=88)g='A'; else if(score>=82)g='B+'; else if(score>=72)g='B'; else if(score>=58)g='C'; else if(score>=38)g='D';
            const badge = document.getElementById('ui-titan-master-orb-grade'); badge.innerText = g; badge.style.color = COLORS[g]; badge.style.borderColor = COLORS[g]; badge.style.boxShadow = `0 0 55px ${COLORS[g]}`;
            bar.style.background = COLORS[g];
            document.getElementById('ui-titan-cart-item-count').innerText = State.cart.length;

            // RENDER INTELLIGENCE PILL CLOUD
            const tMap = {'a-milk':'ğŸ¥› ×—×œ×‘','a-gluten':'ğŸ ×’×œ×•×˜×Ÿ','m-diabetes':'ğŸ’‰ ×¡×•×›×¨×ª','q-green':'âœ… ×™×¨×•×§','l-vegan':'ğŸŒ± ×˜×‘×¢×•× ×™','e-local':'ğŸ‡®ğŸ‡± ××§×•××™','q-aplus':'ğŸ‘‘ A+ ×‘×œ×‘×“'};
            document.getElementById('ui-titan-intelligence-pills').innerHTML = State.user.filters.slice(0,10).map(f => `<div class="titan-intelligence-pill">${tMap[f]||f.split('-')[1]}</div>`).join('');
        },
        open: function(id) { document.getElementById('modal-'+id).classList.add('active'); if(id==='cart') Cart.render(); if(id==='history') History.vaultRefreshBI(); if(id==='settings') User.loadMonolithUI(); },
        close: function(id) { document.getElementById('modal-'+id).classList.remove('active'); },
        buildVaultFiltersBI: function() {
            const grades = ['A+','A','B+','B','C','D','E'];
            document.getElementById('vault-bi-grade-chips-matrix').innerHTML = grades.map(g => `<div class="bi-chip" onclick="History.toggleBiGradeBI(this,'${g}')">${g}</div>`).join('');
            document.getElementById('vault-bi-end-date').valueAsDate = new Date();
            let d = new Date(); d.setMonth(d.getMonth()-6);
            document.getElementById('vault-bi-start-date').valueAsDate = d;
        },
        syncVibeRing: function(s) { State.ring=s; this.saveMonolith(); this.monolithRefresh(); this.close('ring'); this.toast('×‘×™×•-×¡×™× ×›×¨×•×Ÿ TITAN ×”×•×©×œ×'); },
        toast: function(m) { const t=document.getElementById('architect-supreme-toast'); t.innerText=m; t.classList.add('is-active'); setTimeout(()=>t.classList.remove('is-active'),3500); },
        togAcc: function(el) { el.parentElement.classList.toggle('is-open'); }
    };

    const Cart = {
        // SUPREME FUZZY LOOKUP ENGINE v9
        executeTitanFuzzyLookup: function() {
            const query = document.getElementById('inp-titan-lookup-master-class').value.toLowerCase().trim();
            if(!query) return;
            
            // NEURAL FUZZY MATCHING
            let results = MASTER_TITAN_DB.filter(x => 
                x.id === query || 
                x.fullName.toLowerCase().includes(query) || 
                x.n.toLowerCase().includes(query)
            );
            
            if(results.length > 0) {
                // Return best match (Priority to IL Barcodes)
                const best = results.find(r => r.id.startsWith('729')) || results[0];
                Scanner.analyzeQuantumV9(best);
            } else {
                // Fail-safe AI Synthesizer
                const synth = { n:query, b:'×–×™×”×•×™ ARCHITECT v9', g:'C', tags:[], sugar:0, salt:0, id:Date.now().toString() };
                Scanner.analyzeQuantumV9(synth);
            }
            document.getElementById('inp-titan-lookup-master-class').value='';
        },
        addMonolithValidated: function(home) {
            const item = { ...State.temp, t:new Date().toISOString(), u:home?'×‘×™×ª':'×× ×™' };
            State.cart.push(item); State.history.unshift(item); App.saveMonolith(); App.close('result'); App.monolithRefresh(); App.toast('× ×™×ª×•×— TITAN ×”×•×¡×£ ×œ×¡×œ');
        },
        monolithPurgeAll: function() { if(confirm('×œ××—×•×§ ××ª ×›×œ × ×ª×•× ×™ ×”×¡×œ?')){ State.cart=[]; App.saveMonolith(); App.monolithRefresh(); App.close('cart'); } },
        render: function() {
            const con=document.getElementById('ui-monolith-cart-payload');
            if(State.cart.length===0){ con.innerHTML='<div style="text-align:center; padding:120px; color:#64748b; font-weight:1000; letter-spacing:4px; text-transform:uppercase;">×¡×œ ×¨×™×§ - ×× × ×‘×¦×¢ ×¡×¨×™×§×”</div>'; return; }
            con.innerHTML = State.cart.map((i,x)=>`
                <div class="master-monolith-row">
                    <div style="display:flex; align-items:center;">
                        <span class="g-badge-supreme-titan" style="background:${COLORS[i.g]}">${i.g}</span>
                        <div style="margin-right:35px;"><h4 style="font-size:24px; font-weight:1000;">${i.n}</h4><span style="font-size:16px; color:#64748b; font-weight:900;">${i.b} â€¢ ${i.u}</span></div>
                    </div>
                    <div style="color:var(--g-e); cursor:pointer; font-size:32px;" onclick="State.cart.splice(${x},1); App.saveMonolith(); Cart.render(); App.monolithRefresh();"><i class="fa-solid fa-circle-xmark"></i></div>
                </div>`).join('');
        }
    };

    const History = {
        vaultRefreshBI: function() {
            const txt=document.getElementById('vault-bi-search-input').value.toLowerCase();
            const start=new Date(document.getElementById('vault-bi-start-date').value).getTime();
            const end=new Date(document.getElementById('vault-bi-end-date').value).getTime() + 86400000;
            let list = State.history.filter(i => {
                const t = new Date(i.t).getTime();
                const mDate = t>=start && t<=end;
                const mTxt = i.n.toLowerCase().includes(txt) || i.b.toLowerCase().includes(txt);
                const mGrade = State.vaultGrades.length === 0 || State.vaultGrades.includes(i.g);
                return mDate && mTxt && mGrade;
            });
            const con=document.getElementById('ui-monolith-vault-payload');
            if(State.isAgg){
                let agg=new Map(); 
                list.forEach(i=>{ const k=i.n+i.b; if(!agg.has(k))agg.set(k,{...i,count:0}); agg.get(k).count++; });
                con.innerHTML = Array.from(agg.values()).map(i => `
                    <div class="master-monolith-row">
                        <div><h4 style="font-size:24px; font-weight:1000;">${i.n}</h4><span style="color:#666; font-weight:900;">${i.b}</span></div>
                        <div style="display:flex; align-items:center; gap:25px;"><div style="background:var(--plasma-indigo); color:#fff; padding:12px 28px; border-radius:22px; font-size:18px; font-weight:1000; box-shadow:0 10px 25px rgba(0,0,0,0.5);">x${i.count}</div><span class="g-badge-supreme-titan" style="background:${COLORS[i.g]}">${i.g}</span></div>
                    </div>`).join('');
            } else {
                con.innerHTML = list.map(i => `
                    <div class="master-monolith-row">
                        <div><h4 style="font-weight:1000; font-size:24px;">${i.n}</h4><span style="font-size:16px; color:#666; font-weight:900;">${i.b} â€¢ ${new Date(i.t).toLocaleDateString()}</span></div>
                        <span class="g-badge-supreme-titan" style="background:${COLORS[i.g]}">${i.g}</span>
                    </div>`).join('');
            }
        },
        toggleVaultAggregationBI: function() { State.isAgg=!State.isAgg; document.getElementById('ui-agg-status-bi').innerText=State.isAgg?'ON':'OFF'; this.vaultRefreshBI(); },
        toggleBiGradeBI: function(el,g) { el.classList.toggle('active'); if(State.vaultGrades.includes(g)) State.vaultGrades=State.vaultGrades.filter(x=>x!==g); else State.vaultGrades.push(g); this.vaultRefreshBI(); }
    };

    const User = {
        deployTitanProfile: function() {
            State.user.name = document.getElementById('inp-master-architect-identity').value || '××•×¨×—';
            State.user.filters=[]; document.querySelectorAll('.param-chip-master-input:checked').forEach(c=>State.user.filters.push(c.id));
            App.saveMonolith(); App.close('settings'); App.monolithRefresh(); App.toast('××¨×›×™×˜×§×˜×•×¨×” × ×¤×¨×¡×” ×‘-100%');
        },
        loadMonolithUI: function() {
            document.getElementById('inp-master-architect-identity').value = State.user.name;
            document.querySelectorAll('.param-chip-master-input').forEach(c => c.checked = State.user.filters.includes(c.id));
        }
    };

    const Scanner = {
        singletonV9: null,
        deployQuantumV9: function() {
            document.getElementById('master-quantum-viewport-v9').style.display='flex';
            document.getElementById('master-quantum-viewport-v9').classList.add('is-active');
            if(!this.singletonV9) {
                this.singletonV9 = new Html5Qrcode("qr-engine-v9-monolith", { verbose: false });
            }
            // TITAN UHD CONFIGURATION v9
            const config = { 
                fps: 32, 
                qrbox: { width: 400, height: 400 }, 
                aspectRatio: 1.0, 
                videoConstraints: { 
                    facingMode: "environment", 
                    focusMode: "continuous", 
                    width: { ideal: 1920 }, 
                    height: { ideal: 1080 } 
                },
                experimentalFeatures: { useBarCodeDetectorIfSupported: true }
            };
            this.singletonV9.start({ facingMode: "environment" }, config, (txt)=>{
                this.terminateV9(); 
                let p = MASTER_TITAN_DB.find(x=>x.id===txt); 
                this.analyzeQuantumV9(p || { n:'×œ× ×–×•×”×”', b:'×›×œ×œ×™', g:'D', tags:[], sugar:0, salt:0, id:txt });
            }).catch(()=>{ 
                // Simulation Fallback for PC/QA Testing
                setTimeout(()=> { this.terminateV9(); this.analyzeQuantumV9(MASTER_TITAN_DB[Math.floor(Math.random()*15)]); }, 2500); 
            });
        },
        terminateV9: function() { if(this.singletonV9) this.singletonV9.stop().then(()=>this.singletonV9.clear()); document.getElementById('master-quantum-viewport-v9').style.display='none'; },
        analyzeQuantumV9: function(p) {
            let g=p.g, reasons=[], f=State.user.filters;
            
            // SUPREME QUANTUM LOGIC ENGINE V9 (STRESS VETO IMPLEMENTED)
            let veto = false;
            
            // 1. MEDICAL VETO (Level 1)
            if(f.includes('m-diabetes') && (p.sugar > 10 || p.tags.includes('sug'))){ g='E'; reasons.push('×¡×•×›×¨ (MEDICAL VETO ×¡×•×›×¨×ª)'); veto=true; }
            if(f.includes('a-milk') && p.tags.includes('da')){ g='E'; reasons.push('××›×™×œ ×—×œ×‘ (MEDICAL VETO)'); veto=true; }
            if(f.includes('a-gluten') && p.tags.includes('gl')){ g='E'; reasons.push('××›×™×œ ×’×œ×•×˜×Ÿ (MEDICAL VETO)'); veto=true; }
            if(f.includes('m-celiac') && p.tags.includes('gl')){ g='E'; reasons.push('×’×œ×•×˜×Ÿ (MEDICAL VETO ×¦×œ×™××§)'); veto=true; }
            if(f.includes('m-pressure') && (p.salt > 500)){ g='E'; reasons.push('× ×ª×¨×Ÿ (MEDICAL VETO ×œ×—×¥ ×“×)'); veto=true; }

            // 2. STRESS VETO (Level 2) - QA Loop 4 Fix
            if(!veto && State.ring==='stress' && p.tags.includes('caff')) { g='E'; reasons.push('×§×¤××™×Ÿ (STRESS VETO)'); veto=true; }

            // 3. BIO-SYNC SYNERGY
            if(!veto && g!=='E') {
                if(State.ring==='stress' && p.sugar > 5) { g='D'; reasons.push('×¡×•×›×¨ ×’×‘×•×” (××’×‘×™×¨ ×¡×˜×¨×¡)'); }
                if(State.ring==='sick' && p.tags.includes('da')) { g='D'; reasons.push('×—×œ×‘ (××’×‘×™×¨ ×œ×™×—×” ×‘×—×•×œ×™)'); }
                if(State.ring==='sugar' && p.sugar > 10) { 
                    reasons.push('××¢×œ×” ×¡×•×›×¨ (××•××œ×¥ ×œ× ×¤×™×œ×”)');
                    if(g==='C') g='B'; else if(g==='B') g='B+'; else if(g==='B+') g='A';
                }
            }

            // 4. QUALITY & AVOIDANCE LOGIC
            if(f.includes('q-green') && !p.tags.includes('green')){ if(!veto) g='D'; reasons.push('××™× ×• ×ª×• ×™×¨×•×§ ××•×¨×©×”'); }
            if(f.includes('q-aplus') && g!=='A+'){ if(!veto && g!=='E') g='D'; reasons.push('××™× ×• ×¢×•××“ ×‘×ª×§×Ÿ A+'); }
            if(f.includes('x-proc') && p.tags.includes('proc')){ if(!veto && g!=='E') g='D'; reasons.push('××–×•×Ÿ ××¢×•×‘×“'); }

            State.temp = { ...p, g: g };
            
            // RENDER SUPREME RESULT ARCHITECTURE
            const el = document.getElementById('res-titan-grade-orb'); el.innerText=g; el.style.color=COLORS[g]; el.style.borderColor=COLORS[g];
            document.getElementById('res-titan-name-ui').innerText=p.n; document.getElementById('res-titan-brand-ui').innerText=p.b;
            
            // ISRAEL CHAIN SIMULATOR v9
            const chains = [{n:'×¨××™ ×œ×•×™', p:0.92}, {n:'×©×•×¤×¨×¡×œ', p:1.15}, {n:'×™×•×—× × ×•×£', p:0.96}, {n:'×§×¨×¤×•×¨', p:1.08}];
            const baseP = 6.50 + Math.random()*30;
            document.getElementById('res-retailer-matrix').innerHTML = chains.map(c => `
                <div style="background:rgba(255,255,255,0.08); padding:22px; border-radius:26px; display:flex; justify-content:space-between; align-items:center; border:1px solid rgba(255,255,255,0.12);">
                    <span style="font-weight:1000; font-size:18px; color:#ddd;">${c.n}</span>
                    <span style="color:var(--g-a); font-weight:1000; font-size:22px;">â‚ª${(baseP * c.p).toFixed(2)}</span>
                </div>
            `).join('');

            document.getElementById('res-titan-intelligence-report').innerHTML = reasons.length ? reasons.map(r=>`<div class="intelligence-row-titan"><i class="fa-solid fa-triangle-exclamation" style="color:var(--g-e)"></i><span style="color:var(--g-e); font-weight:1000;">${r}</span></div>`).join('') : '<div style="color:var(--g-ap); font-weight:1000; font-size:26px;"><i class="fa-solid fa-shield-check"></i> ××•×¦×¨ ×××•××ª ×•×ª×§×™×Ÿ ×œ×—×œ×•×˜×™×Ÿ</div>';
            
            App.open('result');
        }
    };

    // --- ANALYTIC MAPPING HELPERS ---
    const COLORS = {'A+':'var(--g-ap)','A':'var(--g-a)','B+':'var(--g-bp)','B':'var(--g-b)','C':'var(--g-c)','D':'var(--g-d)','E':'var(--g-e)'};
    const SCORES = {'A+':100,'A':95,'B+':88,'B':78,'C':60,'D':40,'E':12};

    App.init();
</script>
</body>
</html>
